<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>××¤×™×•×Ÿ ××¢×¨×›×ª CRM</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOKENS â€” Light Mode
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --bg:           #f8fafc;
  --surface:      #ffffff;
  --surface-2:    #f1f5f9;
  --surface-3:    #e8edf5;
  --border:       #e2e8f0;
  --border-focus: #2563eb;
  --navy:         #0f172a;
  --slate-700:    #334155;
  --slate-500:    #64748b;
  --slate-400:    #94a3b8;
  --blue:         #2563eb;
  --blue-light:   #eff6ff;
  --blue-hover:   #1d4ed8;
  --green:        #059669;
  --green-light:  #ecfdf5;
  --amber:        #d97706;
  --amber-light:  #fffbeb;
  --red-light:    #fef2f2;
  --shadow-sm:    0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04);
  --shadow-md:    0 4px 16px rgba(0,0,0,0.06), 0 2px 6px rgba(0,0,0,0.04);
  --shadow-card:  0 20px 50px rgba(0,0,0,0.06), 0 4px 12px rgba(0,0,0,0.04);
  --radius-xl:    18px;
  --radius-lg:    12px;
  --radius-md:    8px;
  --font:         'Heebo', 'Segoe UI', Arial, sans-serif;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET & BASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: var(--font);
  font-weight: 400;
  line-height: 1.6;
  direction: rtl;
  background: var(--bg);
  min-height: 100vh;
  padding: 32px 16px;
  color: var(--navy);
}

/* Thin progress line */
#top-bar { position: fixed; top: 0; right: 0; left: 0; height: 3px; z-index: 999; background: var(--border); }
#top-bar-fill {
  height: 100%;
  background: var(--blue);
  transition: width 0.5s cubic-bezier(.4,0,.2,1);
}

.container { max-width: 680px; margin: 0 auto; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TYPOGRAPHY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
h1 { font-size: clamp(22px, 4vw, 28px); font-weight: 800; color: var(--navy); line-height: 1.3; }
h2 { font-size: 17px; font-weight: 700; color: var(--navy); display: flex; align-items: center; gap: 8px; }
h3 { font-size: 14px; font-weight: 600; margin-bottom: 10px; }
.subtitle { color: var(--slate-500); font-size: 14px; font-weight: 300; margin-top: 6px; line-height: 1.6; }
.eyebrow {
  font-size: 11px; font-weight: 700; letter-spacing: 1.5px;
  text-transform: uppercase; color: var(--blue); margin-bottom: 4px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARDS & SURFACES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.card {
  background: var(--surface);
  border-radius: var(--radius-xl);
  border: 1px solid var(--border);
  box-shadow: var(--shadow-card);
  overflow: hidden;
  margin-bottom: 16px;
}
.card-header {
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  padding: 24px 40px;
}
.card-body { padding: 40px; }

.glass {
  background: var(--surface);
  border-radius: var(--radius-lg);
  border: 1px solid var(--border);
  box-shadow: var(--shadow-sm);
  padding: 28px;
  margin-bottom: 12px;
  transition: box-shadow 0.2s, border-color 0.2s;
}
.glass:hover { box-shadow: var(--shadow-md); border-color: #cbd5e1; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORM ELEMENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.label {
  display: block;
  font-weight: 600;
  color: var(--navy);
  margin-bottom: 10px;
  font-size: 14px;
  line-height: 1.6;
}

input[type=text], textarea, select {
  width: 100%;
  padding: 13px 16px;
  border-radius: var(--radius-md);
  border: 1.5px solid transparent;
  background: var(--surface-2);
  color: var(--navy);
  font-size: 14px;
  font-family: var(--font);
  font-weight: 400;
  line-height: 1.6;
  outline: none;
  direction: rtl;
  transition: all 0.18s ease;
}
input[type=text]::placeholder, textarea::placeholder { color: var(--slate-400); }
input[type=text]:focus, textarea:focus, select:focus {
  background: var(--surface);
  border-color: var(--border-focus);
  box-shadow: 0 0 0 3px rgba(37,99,235,0.1);
}
input[type=text]:hover:not(:focus), textarea:hover:not(:focus), select:hover:not(:focus) {
  background: #edf2f7;
}
textarea { resize: vertical; line-height: 1.7; min-height: 110px; }
select option { background: var(--surface); color: var(--navy); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHIPS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.chips { display: flex; flex-wrap: wrap; gap: 8px; }
.chip {
  padding: 7px 16px;
  border-radius: 100px;
  border: 1.5px solid var(--border);
  background: var(--surface);
  color: var(--slate-700);
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  font-family: var(--font);
  transition: all 0.16s ease;
  user-select: none;
  box-shadow: var(--shadow-sm);
}
.chip:hover {
  border-color: var(--blue);
  color: var(--blue);
  background: var(--blue-light);
  box-shadow: var(--shadow-md);
}
.chip.active {
  background: var(--blue);
  border-color: var(--blue);
  color: #fff;
  box-shadow: 0 4px 12px rgba(37,99,235,0.3);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   QUESTION ANIMATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.q-group { display: flex; flex-direction: column; gap: 32px; }

@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(12px); }
  to   { opacity: 1; transform: translateY(0); }
}
.q-item { animation: fadeInUp 0.3s ease both; }
.q-item:nth-child(1) { animation-delay: 0.03s; }
.q-item:nth-child(2) { animation-delay: 0.08s; }
.q-item:nth-child(3) { animation-delay: 0.13s; }
.q-item:nth-child(4) { animation-delay: 0.18s; }
.q-item:nth-child(5) { animation-delay: 0.23s; }
.q-item:nth-child(6) { animation-delay: 0.28s; }
.q-item:nth-child(7) { animation-delay: 0.33s; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUTTONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn {
  padding: 11px 24px;
  border-radius: var(--radius-md);
  font-size: 14px;
  font-family: var(--font);
  font-weight: 600;
  cursor: pointer;
  transition: all 0.18s ease;
  border: none;
  line-height: 1;
}
.btn-primary {
  background: var(--blue);
  color: #fff;
  box-shadow: 0 2px 8px rgba(37,99,235,0.25);
}
.btn-primary:hover {
  background: var(--blue-hover);
  transform: translateY(-1px);
  box-shadow: 0 6px 20px rgba(37,99,235,0.3);
}
.btn-primary:active { transform: translateY(0); }
.btn-success {
  background: var(--green);
  color: #fff;
  box-shadow: 0 2px 8px rgba(5,150,105,0.25);
}
.btn-success:hover {
  background: #047857;
  transform: translateY(-1px);
  box-shadow: 0 6px 18px rgba(5,150,105,0.3);
}
.btn-outline {
  background: var(--surface);
  color: var(--slate-700);
  border: 1.5px solid var(--border);
  box-shadow: var(--shadow-sm);
}
.btn-outline:hover {
  border-color: #94a3b8;
  color: var(--navy);
  box-shadow: var(--shadow-md);
}
.btn-large { padding: 13px 40px; font-size: 15px; border-radius: var(--radius-lg); }
.btn-ghost {
  background: transparent; border: none;
  color: var(--slate-500); font-size: 13px; font-weight: 500;
  cursor: pointer; font-family: var(--font);
  transition: color 0.15s; padding: 4px 0;
}
.btn-ghost:hover { color: var(--blue); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAV
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.nav {
  display: flex; justify-content: space-between; align-items: center;
  margin-top: 40px; padding-top: 28px;
  border-top: 1px solid var(--border);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STEP PILLS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.step-pills { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 18px; }
.pill {
  padding: 5px 12px; border-radius: 100px; font-size: 11px; font-weight: 600;
  display: flex; align-items: center; gap: 4px;
  transition: all 0.15s; cursor: default; letter-spacing: 0.2px;
  border: 1.5px solid transparent;
}
.pill.done {
  background: var(--green-light); color: var(--green);
  border-color: #a7f3d0; cursor: pointer;
}
.pill.done:hover { background: #d1fae5; }
.pill.active {
  background: var(--blue); color: #fff;
  box-shadow: 0 2px 8px rgba(37,99,235,0.25);
}
.pill.todo { background: var(--surface-2); color: var(--slate-400); border-color: var(--border); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INFO & BADGES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.info-row { display: flex; gap: 16px; align-items: baseline; margin-bottom: 12px; font-size: 14px; }
.info-label { color: var(--slate-400); font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.8px; white-space: nowrap; }
.info-value { color: var(--navy); font-weight: 400; }
.challenge-item { display: flex; gap: 10px; align-items: flex-start; margin-bottom: 8px; }
.challenge-dot {
  width: 5px; height: 5px; border-radius: 50%;
  background: var(--blue); flex-shrink: 0; margin-top: 9px;
}

.topic-badge {
  display: inline-flex; align-items: center; gap: 5px;
  padding: 5px 12px; border-radius: 100px;
  background: var(--blue-light); border: 1px solid #bfdbfe;
  color: var(--blue); font-size: 12px; font-weight: 500; margin: 3px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FEATURE GRID
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.feature-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.feature-item {
  display: flex; align-items: center; gap: 10px;
  background: var(--surface-2); border: 1px solid var(--border);
  border-radius: var(--radius-md); padding: 12px 14px;
  font-size: 13px; color: var(--slate-700);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESULT & STATUS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.result-header {
  background: var(--green-light);
  border-bottom: 1px solid #a7f3d0;
  padding: 36px 40px; text-align: center;
}
.result-header h2 { color: #065f46; font-size: 20px; justify-content: center; }
.result-header p { color: var(--green); font-size: 14px; font-weight: 300; margin-top: 4px; }

.action-btns { display: flex; gap: 10px; flex-wrap: wrap; }

.status-box {
  padding: 14px 16px; border-radius: var(--radius-md); margin-bottom: 16px;
  display: flex; align-items: center; gap: 10px; font-size: 13px; font-weight: 500;
  animation: fadeInUp 0.25s ease both;
}
.status-sending { background: var(--amber-light); color: var(--amber); border: 1px solid #fde68a; }
.status-success  { background: var(--green-light); color: var(--green); border: 1px solid #a7f3d0; }
.status-error    { background: var(--red-light); color: #dc2626; border: 1px solid #fecaca; }

.stat-box {
  background: var(--surface-2); border: 1px solid var(--border);
  border-radius: var(--radius-md); padding: 18px; text-align: center;
}
.stat-label { color: var(--slate-400); font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px; }
.stat-value { font-size: 22px; font-weight: 800; color: var(--navy); }

.unanswered-box {
  background: var(--amber-light); border: 1px solid #fde68a;
  border-radius: var(--radius-md); padding: 16px; margin-top: 12px;
}
.unanswered-item {
  color: #92400e; font-size: 13px;
  border-right: 3px solid #fbbf24;
  padding: 4px 10px; margin-bottom: 6px;
}
.all-answered {
  background: var(--green-light); border: 1px solid #a7f3d0;
  border-radius: var(--radius-md); padding: 12px 16px;
  color: var(--green); font-weight: 600; margin-top: 12px; font-size: 14px;
}

/* Backup banner */
.backup-banner {
  background: var(--blue-light); border: 1px solid #bfdbfe;
  border-radius: var(--radius-lg); padding: 20px; margin-bottom: 16px; text-align: center;
}

.divider { border: none; border-top: 1px solid var(--border); margin: 20px 0; }

.spinner {
  width: 15px; height: 15px; border: 2px solid currentColor;
  border-top-color: transparent; border-radius: 50%;
  animation: spin 0.7s linear infinite; flex-shrink: 0;
}
@keyframes spin { to { transform: rotate(360deg); } }
.hidden { display: none; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PDF TEMPLATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#pdf-template {
  display: none; direction: rtl;
  font-family: 'Heebo', Arial, sans-serif;
  background: #fff; padding: 0; width: 210mm; color: #1e293b;
}
.pdf-cover { background: linear-gradient(135deg, #0f172a, #1e3a5f); padding: 60px 50px; min-height: 297mm; display: flex; flex-direction: column; justify-content: space-between; }
.pdf-cover-logo { font-size: 64px; margin-bottom: 20px; }
.pdf-cover-title { color: #fff; font-size: 32px; font-weight: 800; margin-bottom: 8px; }
.pdf-cover-sub { color: #93c5fd; font-size: 18px; margin-bottom: 40px; }
.pdf-cover-client { background: rgba(255,255,255,0.1); border-radius: 16px; padding: 28px; border: 1px solid rgba(255,255,255,0.2); }
.pdf-cover-client h3 { color: #60a5fa; font-size: 13px; letter-spacing: 2px; margin-bottom: 16px; }
.pdf-cover-meta { color: #fff; font-size: 16px; margin-bottom: 10px; }
.pdf-cover-meta span { color: #94a3b8; font-size: 14px; }
.pdf-cover-footer { color: #475569; font-size: 13px; margin-top: 20px; }
.pdf-cover-badges { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 16px; }
.pdf-cover-badge { background: rgba(59,130,246,0.2); border: 1px solid rgba(59,130,246,0.4); color: #93c5fd; padding: 6px 14px; border-radius: 20px; font-size: 12px; }
.pdf-page { padding: 40px 50px; page-break-inside: avoid; }
.pdf-section-header { display: flex; align-items: center; gap: 12px; background: linear-gradient(135deg, #1e3a5f, #1e40af); color: #fff; padding: 16px 24px; border-radius: 12px; margin-bottom: 20px; margin-top: 30px; }
.pdf-section-icon { font-size: 24px; }
.pdf-section-title { font-size: 18px; font-weight: 700; }
.pdf-qa { margin-bottom: 18px; page-break-inside: avoid; }
.pdf-question { font-weight: 600; color: #334155; font-size: 14px; margin-bottom: 6px; }
.pdf-answer { background: #f8fafc; border-right: 4px solid #2563eb; padding: 10px 16px; border-radius: 0 8px 8px 0; color: #1e293b; font-size: 14px; line-height: 1.7; white-space: pre-wrap; }
.pdf-answer.empty { color: #94a3b8; font-style: italic; background: #fafafa; border-right-color: #e2e8f0; }
.pdf-meta-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px; }
.pdf-meta-box { background: #f1f5f9; border-radius: 10px; padding: 16px; }
.pdf-meta-label { color: #64748b; font-size: 12px; margin-bottom: 4px; }
.pdf-meta-value { font-size: 18px; font-weight: 700; color: #1e293b; }
.pdf-unanswered { background: #fef9c3; border: 2px solid #fde047; border-radius: 12px; padding: 20px; margin-top: 20px; }
.pdf-unanswered h3 { color: #854d0e; margin-bottom: 12px; }
.pdf-unanswered-item { color: #92400e; font-size: 13px; border-right: 3px solid #fbbf24; padding: 4px 10px; margin-bottom: 6px; }
.pdf-divider { border: none; border-top: 2px solid #e2e8f0; margin: 24px 0; }
.pdf-footer { color: #94a3b8; font-size: 11px; text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid #e2e8f0; }
</style>
</head>
<body>

<!-- TOP PROGRESS BAR -->
<div id="top-bar"><div id="top-bar-fill" style="width:0%"></div></div>

<!-- â”€â”€â”€ APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="container" id="app">
  <!-- Screens rendered by JS -->
</div>

<!-- â”€â”€â”€ PDF TEMPLATE (hidden, used for generation) â”€â”€â”€ -->
<div id="pdf-template"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CONFIG  â€” ×¢×“×›×Ÿ ××ª ×”×›×ª×•×‘×ª ×©×œ ×”-n8n Webhook ×©×œ×š
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const N8N_WEBHOOK_URL = "https://elishamaf.app.n8n.cloud/webhook/crm-form";
const RECIPIENT_EMAIL = "ELISHAMA1324@GMAIL.COM";

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const KNOWN_INFO = {
  challenges: [
    "× ×™×”×•×œ ×”×–×× ×•×ª ×œ×§×•×—×•×ª ××¨×•×‘×•×ª ×‘××§×‘×™×œ",
    "××¢×§×‘ ×”×¦×¢×•×ª ××—×™×¨ ×œ×¡×¤×§×™× + ×ª×–×›×•×¨×•×ª",
    "×¢×“×›×•×Ÿ ×ª×§×•×¤×ª×™ ×©×œ ×œ×§×•×—×•×ª ×¢×œ ×¡×˜×˜×•×¡ ×”×–×× ×”",
    "× ×™×”×•×œ ×’×¨×¡××•×ª ×©×•× ×•×ª ×©×œ ×”×¦×¢×•×ª ××—×™×¨",
    "××¢×§×‘ ××™×™×œ×™× ×©× ×©×œ×—×• (×”×× ×”×ª×§×‘×œ×• / × ×¢× ×•)",
    "×¢×‘×•×“×” ××•×œ ×¢××™×œ×™ ××›×¡",
    "×§×™×˜×œ×•×’ ××¡××›×™× ×œ×¤×™ ×œ×§×•×— ×•×¤×¨×™×˜",
  ]
};

const STEPS = [
  {
    id: "updates", title: "×¢×“×›×•× ×™× ×•×ª×–×›×•×¨×•×ª", icon: "ğŸ””",
    questions: [
      { id: "customer_update_freq", label: "×›××” ×¤×¢××™× ×‘×©×‘×•×¢/×—×•×“×© ××ª ××¢×“×›× ×ª ×œ×§×•×—×•×ª ×¢×œ ×¡×˜×˜×•×¡ ×”×–×× ×”?", type: "select", options: ["×›×œ ×™×•×","×¤×¢××™×™× ×‘×©×‘×•×¢","×¤×¢× ×‘×©×‘×•×¢","×¤×¢× ×‘×©×‘×•×¢×™×™×","×¨×§ ×›×©×™×© ×¢×“×›×•×Ÿ"] },
      { id: "update_method", label: "××™×š ××ª ×‘×“×¨×š ×›×œ×œ ××¢×“×›× ×ª ×œ×§×•×—×•×ª?", type: "chips", options: ["××™×™×œ","×•×•××˜×¡××¤","×˜×œ×¤×•×Ÿ","×”×œ×§×•×— ×¤×•× ×” ××œ×™×™"] },
      { id: "update_content", label: "××” ×‘×“×¨×š ×›×œ×œ ×›×•×œ×œ ×”×¢×“×›×•×Ÿ ×œ×œ×§×•×—?", type: "chips", options: ["×¡×˜×˜×•×¡ ×”×–×× ×”","×ª××¨×™×š ××¡×¤×§×” ×¦×¤×•×™","××™×§×•× ×”××©×œ×•×—","×¢×™×›×•×‘×™×","××¡××›×™×","××—×¨"] },
      { id: "auto_update", label: "×”×× ×ª×©××—×™ ×©×”××¢×¨×›×ª ×ª×©×œ×— ×¢×“×›×•×Ÿ ××•×˜×•××˜×™ ×œ×œ×§×•×— ×¤×¢× ×‘×©×‘×•×¢?", type: "select", options: ["×›×Ÿ, ×–×” ×™×—×¡×•×š ×œ×™ ×”×¨×‘×” ×–××Ÿ","×›×Ÿ, ××‘×œ ×¨×•×¦×” ×œ××©×¨ ×œ×¤× ×™ ×©×œ×™×—×”","×œ×, ×× ×™ ×¨×•×¦×” ×œ×©×œ×•×— ×‘×¢×¦××™","×ª×œ×•×™ ×‘×œ×§×•×—"] },
      { id: "boss_followup", label: "×”×‘×•×¡ ××‘×§×© ×œ×¤×¢××™× ×œ×¢×§×•×‘ ××—×¨×™ ××™×™×œ×™× ××¡×•×™××™× â€” ××™×š ×–×” ×¢×•×‘×“ ×›×™×•×?", type: "textarea", placeholder: "×œ×“×•×’××”: ×”×•× ×©×•×œ×— ×œ×™ ×”×•×“×¢×” ×©××‘×“×•×§ ×× ×¡×¤×§ X ×¢× ×”..." },
      { id: "missed_followup", label: "×”×× ×§×¨×” ×©×¤×¡×¤×¡×ª ××¢×§×‘ ×¢×œ ××™×™×œ ×—×©×•×‘?", type: "select", options: ["×œ×","×¤×¢× ××—×ª","×›××” ×¤×¢××™×","×§×•×¨×” ×œ×¢×™×ª×™× ×§×¨×•×‘×•×ª"] },
    ]
  },
  {
    id: "quotes", title: "×”×¦×¢×•×ª ××—×™×¨ ×œ×¡×¤×§×™×", icon: "ğŸ’°",
    questions: [
      { id: "quote_open", label: "×›××” ×”×¦×¢×•×ª ××—×™×¨ ×¤×ª×•×—×•×ª (×©×××ª×™× ×•×ª ×œ×ª×©×•×‘×”) ×™×© ×œ×š ×‘×××•×¦×¢ ×‘×›×œ ×¨×’×¢?", type: "select", options: ["1-3","4-10","11-20","×™×•×ª×¨ ×-20"] },
      { id: "quote_wait", label: "×›××” ×–××Ÿ ×‘×××•×¦×¢ ×œ×•×§×— ×œ×¡×¤×§ ×œ×—×–×•×¨ ×¢× ×”×¦×¢×”?", type: "select", options: ["×¢×“ 24 ×©×¢×•×ª","1-3 ×™××™×","×©×‘×•×¢","×™×•×ª×¨ ××©×‘×•×¢","×ª×œ×•×™ ×‘×¡×¤×§"] },
      { id: "quote_track", label: "×›×™×¦×“ ××ª ×¢×•×§×‘×ª ×›×™×•× ××—×¨×™ ×¡×¤×§×™× ×©×œ× ×¢× ×•?", type: "textarea", placeholder: "×œ×“×•×’××”: ×ª×–×›×•×¨×ª ×‘×˜×œ×¤×•×Ÿ, ××¡×× ×ª ×‘××§×¡×œ..." },
      { id: "quote_remind_time", label: "××—×¨×™ ×›××” ×–××Ÿ ×œ×œ× ×ª×©×•×‘×” ××ª ×©×•×œ×—×ª ×ª×–×›×•×¨×ª ×œ×¡×¤×§?", type: "select", options: ["×™×•× ××—×“","2-3 ×™××™×","×©×‘×•×¢","×ª×œ×•×™ ×‘×“×—×™×¤×•×ª"] },
      { id: "quote_auto_remind", label: "×”×× ×ª×©××—×™ ×©×”××¢×¨×›×ª ×ª×ª×¨×™×¢ ×›×©×¡×¤×§ ×œ× ×¢× ×”?", type: "select", options: ["×›×Ÿ, ×‘×”×—×œ×˜!","×›×Ÿ, ××‘×œ ×× ×™ ×©×•×œ×—×ª ×‘×¢×¦××™","×œ× ×¦×¨×™×š"] },
      { id: "quote_multi", label: "×”×× ×œ××•×ª×• ×¤×¨×™×˜ ××ª ×©×•×œ×—×ª ×œ×›××” ×¡×¤×§×™× ×‘××§×‘×™×œ?", type: "select", options: ["×›×Ÿ, ×ª××™×“","×œ×¤×¢××™×","×œ×, ×‘×“×¨×š ×›×œ×œ ×¡×¤×§ ××—×“"] },
      { id: "quote_compare", label: "×›×©×™×© ×›××” ×”×¦×¢×•×ª ×œ××•×ª×• ×¤×¨×™×˜ â€” ××™×š ××ª ××©×•×•×” ×‘×™× ×™×”×Ÿ?", type: "textarea", placeholder: "×œ×“×•×’××”: ××¢×ª×™×§×” ×œ××§×¡×œ ×•××©×•×•×” ×™×“× ×™×ª..." },
    ]
  },
  {
    id: "versions", title: "×’×¨×¡××•×ª ×•×©×™× ×•×™×™×", icon: "ğŸ”€",
    questions: [
      { id: "ver_freq", label: "×›××” ×¤×¢××™× ×”×œ×§×•×— ××©× ×” ×“×¨×™×©×” ××—×¨×™ ×©×›×‘×¨ ×‘×™×§×©×ª ×”×¦×¢×ª ××—×™×¨?", type: "select", options: ["×›××¢×˜ ××£ ×¤×¢×","×œ×¤×¢××™× (20-30%)","×œ×¢×™×ª×™× ×§×¨×•×‘×•×ª","×›××¢×˜ ×ª××™×“"] },
      { id: "ver_what", label: "××” ×‘×“×¨×š ×›×œ×œ ××©×ª× ×”?", type: "chips", options: ["×›××•×ª","××¤×¨×˜ ×˜×›× ×™","×¦×‘×¢ / ×—×•××¨","×ª××¨×™×š ××¡×¤×§×”","×›×ª×•×‘×ª ××©×œ×•×—","××—×™×¨ ××‘×•×§×©","××—×¨"] },
      { id: "ver_manage", label: "×›×™×¦×“ ××ª ×× ×”×œ×ª ×›×™×•× ××ª ×”×’×¨×¡××•×ª ×”×©×•× ×•×ª?", type: "textarea", placeholder: "×œ×“×•×’××”: ×©×•××¨×ª ×›×œ ××™×™×œ, ×›×•×ª×‘×ª ×‘×¦×“ ×‘××§×¡×œ..." },
      { id: "ver_mistake", label: "×”×× ×§×¨×” ×©× ×©×œ×—×” ×”×¦×¢×ª ××—×™×¨ ×œ×¤×™ ×’×¨×¡×” ×™×©× ×” ×‘×˜×¢×•×ª?", type: "select", options: ["×œ×","×¤×¢× ××—×ª","×›××” ×¤×¢××™×","×›×Ÿ, ×–×” ×§×•×¨×”"] },
      { id: "ver_ideal", label: "××” ×”××™×“×™××œ ×©×œ×š ×œ× ×™×”×•×œ ×’×¨×¡××•×ª?", type: "textarea", placeholder: "×œ×“×•×’××”: ×œ×¨××•×ª ××ª ×›×œ ×”×’×¨×¡××•×ª ×©×œ ××•×ª×” ×”×–×× ×” ×‘×˜×•×¨ ××—×“..." },
    ]
  },
  {
    id: "catalog", title: "×§×™×˜×œ×•×’ ×•××¡××›×™×", icon: "ğŸ“",
    questions: [
      { id: "cat_structure", label: "×›×™×•×, ×œ×¤×™ ××” ×××•×¨×’×Ÿ ×”××™×“×¢ ×©×œ×š?", type: "chips", options: ["×œ×¤×™ ×œ×§×•×—","×œ×¤×™ ×¡×¤×§","×œ×¤×™ ×ª××¨×™×š","×œ×¤×™ ×¡×•×’ ××•×¦×¨","×œ×¤×™ ×¡×˜×˜×•×¡","×œ× ×××© ×××•×¨×’×Ÿ"] },
      { id: "cat_files", label: "××™×¤×” ×©××•×¨×™× ×›×™×•× ×”××¡××›×™×?", type: "chips", options: ["Gmail / Outlook","Google Drive","Dropbox","×ª×™×§×™×•×ª ×‘××—×©×‘","××“×¤×¡×ª / × ×™×™×¨","×œ× ×××•×¨×’×Ÿ"] },
      { id: "cat_search", label: "×›××” ×§×œ ×œ××¦×•× ××¡××š ×™×©×Ÿ ×›×©×¦×¨×™×š?", type: "select", options: ["×§×œ ×××•×“, ×™×© ×œ×™ ×¡×“×¨","××¤×©×¨×™ ××‘×œ ×œ×•×§×— ×–××Ÿ","×§×©×”, ×× ×™ ××—×¤×©×ª ×”×¨×‘×”","×œ×¤×¢××™× ×œ× ××•×¦××ª ×‘×›×œ×œ"] },
      { id: "cat_items", label: "×”×× ×™×© ××•×¦×¨×™× ×—×•×–×¨×™×? ×”×× ×™×© ××—×™×¨×•×Ÿ ×§×™×™×?", type: "textarea", placeholder: "×œ×“×•×’××”: ×™×© ×›××” ×¤×¨×™×˜×™× ×©×œ×§×•×—×•×ª ××–××™× ×™× ×ª××™×“..." },
    ]
  },
  {
    id: "process", title: "×ª×”×œ×™×š ×¢×‘×•×“×”", icon: "ğŸ”„",
    questions: [
      { id: "order_flow", label: "×ª××¨×™ ××ª ××¡×¢ ×”×”×–×× ×” ××©×œ×‘ ×”×›× ×™×¡×” ×¢×“ ××¡×™×¨×” ×œ×œ×§×•×—:", type: "textarea", placeholder: "×œ×“×•×’××”:\n1. ×œ×§×•×— ×©×•×œ×— ×‘×§×©×” ×‘××™×™×œ\n2. ×× ×™ ××‘×™× ×” ××” ×”×•× ×¨×•×¦×”\n3. ×©×•×œ×—×ª ×œ×¡×¤×§×™×\n4. ××—×–×™×¨×” ×œ×œ×§×•×—\n5. ×œ××—×¨ ××™×©×•×¨ â€” ××–××™× ×”\n6. ××¢×§×‘ ×©×™×œ×•×—\n7. ×¢××™×œ ××›×¡\n8. ××¡×™×¨×”" },
      { id: "open_orders", label: "×›××” ×”×–×× ×•×ª ×¤×ª×•×—×•×ª ×‘××§×‘×™×œ ×‘×××•×¦×¢?", type: "select", options: ["1-5","6-15","16-30","×™×•×ª×¨ ×-30"] },
      { id: "customs_flow", label: "×ª××¨×™ ××ª ×”×¢×‘×•×“×” ××•×œ ×¢××™×œ×™ ×”××›×¡:", type: "textarea", placeholder: "×œ×“×•×’××”: ×©×•×œ×—×ª ×œ×”× ××¡××›×™ ×©×™×œ×•×—, ×”× ××¢×“×›× ×™× ××•×ª×™..." },
      { id: "biggest_pain", label: "××” ×”×›×™ ××ª×¡×›×œ ××•×ª×š ×›×™×•×?", type: "textarea", placeholder: "×›×ª×‘×™ ×‘×—×•×¤×©×™×•×ª..." },
    ]
  },
  {
    id: "system", title: "×¦×™×¤×™×•×ª ××”××¢×¨×›×ª", icon: "ğŸ¯",
    questions: [
      { id: "must_have", label: "××” ×—×™×™×‘ ×œ×”×™×•×ª ×‘××¢×¨×›×ª ×›×‘×¨ ××”×™×•× ×”×¨××©×•×Ÿ? (Version 1)", type: "textarea", placeholder: "×”×“×‘×¨×™× ×©×‘×œ×¢×“×™×”× ×”××¢×¨×›×ª ×œ× ×©×™××•×©×™×ª..." },
      { id: "nice_to_have", label: "××” ×™×”×™×” × ×—××“ ××‘×œ ××¤×©×¨ ×œ×”×•×¡×™×£ ××—×¨ ×›×š?", type: "textarea", placeholder: "×¤×™×¦'×¨×™× ×œ×¢×ª×™×“..." },
      { id: "sys_users", label: "××™ ×™×©×ª××© ×‘××¢×¨×›×ª?", type: "chips", options: ["×¨×§ ×× ×™","×”×‘×•×¡ ×©×œ×™","×¢×•×“ ×¢×•×‘×“×™×","×”×œ×§×•×—×•×ª ×¢×¦×× (×¤×•×¨×˜×œ ×œ×§×•×—)"] },
      { id: "mobile", label: "×”×× ×—×©×•×‘ ×©×™×¢×‘×•×“ ×‘× ×™×™×“?", type: "select", options: ["×œ×, ×¨×§ ××—×©×‘","× ×—××“ ×œ×• ×™×©","×—×©×•×‘","×§×¨×™×˜×™ â€” ×× ×™ ×‘×¢×™×§×¨ ×¢×œ ×”× ×™×™×“"] },
      { id: "extra", label: "×™×© ×¢×•×“ ××©×”×• ×©×—×©×•×‘ ×œ×š ×©× ×“×¢?", type: "textarea", placeholder: "×›×œ ×“×‘×¨ ×©×œ× ×©××œ× ×•..." },
    ]
  }
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const STORAGE_KEY = 'crm_form_backup';

function saveBackup() {
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify({
      answers: state.answers,
      startTime: state.startTime,
      savedAt: Date.now()
    }));
  } catch(e) {}
}
function loadBackup() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return null;
    const data = JSON.parse(raw);
    // Only restore if saved less than 24 hours ago
    if (Date.now() - data.savedAt < 86400000) return data;
  } catch(e) {}
  return null;
}
function clearBackup() {
  try { localStorage.removeItem(STORAGE_KEY); } catch(e) {}
}

let state = {
  screen: 'intro',
  step: 0,
  answers: {},
  startTime: null,
  endTime: null,
  emailStatus: 'idle',
  hasBackup: false
};

// Check for saved backup on load
const backup = loadBackup();
if (backup && Object.keys(backup.answers).length > 0) {
  state.hasBackup = true;
  state._backupData = backup;
}

function setState(patch) {
  Object.assign(state, patch);
  // Auto-save on every state change if in quiz
  if (state.screen === 'quiz' || state.screen === 'result') saveBackup();
  render();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getVal(id) {
  const v = state.answers[id];
  if (Array.isArray(v)) return v.length ? v.join(", ") : null;
  return v || null;
}
function setAnswer(id, val, skipRender = false) {
  state.answers[id] = val;
  saveBackup(); // auto-backup on every keystroke
  if (!skipRender) render();
}
function toggleChip(id, opt) {
  const cur = Array.isArray(state.answers[id]) ? state.answers[id] : [];
  state.answers[id] = cur.includes(opt) ? cur.filter(x=>x!==opt) : [...cur, opt];
  render();
}
function formatTime(ms) {
  const totalSec = Math.round(ms / 1000);
  const min = Math.floor(totalSec / 60);
  const sec = totalSec % 60;
  return min > 0 ? `${min} ×“×§×•×ª ×•-${sec} ×©× ×™×•×ª` : `${sec} ×©× ×™×•×ª`;
}
function getUnanswered() {
  const result = [];
  STEPS.forEach(s => {
    s.questions.forEach(q => {
      const v = state.answers[q.id];
      const isEmpty = !v || (Array.isArray(v) && v.length === 0) || v === "";
      if (isEmpty) result.push({ step: s.title, icon: s.icon, question: q.label });
    });
  });
  return result;
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SUMMARY GENERATOR â€” ××¡××š ×¡×™×›×•× ×œ×œ×§×•×—
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function nl2br(str) { return (str || '').split('\n').join('<br>'); }
function generateSummaryHtml(forEmail = false) {
  const g = (id) => getVal(id) || 'â€”';
  const date = new Date().toLocaleDateString('he-IL', { year:'numeric', month:'long', day:'numeric' });

  // Build automated recommendations based on answers
  const recs = [];
  
  // Updates automation
  if (g('auto_update').includes('×›×Ÿ')) recs.push({ icon: 'ğŸ””', text: '×¢×“×›×•×Ÿ ××•×˜×•××˜×™ ×©×‘×•×¢×™ ×œ×œ×§×•×—×•×ª', priority: '×—×•×‘×”' });
  if (g('missed_followup') !== '×œ×') recs.push({ icon: 'ğŸ“§', text: '××¢×§×‘ ××™×™×œ×™× + ×ª×–×›×•×¨×•×ª ××•×˜×•××˜×™×•×ª', priority: '×—×•×‘×”' });
  
  // Quotes
  if (g('quote_auto_remind').includes('×›×Ÿ')) recs.push({ icon: 'â°', text: `×ª×–×›×•×¨×ª ××•×˜×•××˜×™×ª ×œ×¡×¤×§ ×œ××—×¨ ${g('quote_remind_time')}`, priority: '×—×•×‘×”' });
  if (g('quote_multi') !== '×œ×, ×‘×“×¨×š ×›×œ×œ ×¡×¤×§ ××—×“') recs.push({ icon: 'ğŸ“Š', text: '×”×©×•×•××ª ×”×¦×¢×•×ª ××—×™×¨ ××¡×¤×§×™× ××¨×•×‘×™×', priority: '×—×©×•×‘' });
  
  // Versions
  if (!g('ver_freq').includes('×›××¢×˜ ××£ ×¤×¢×')) recs.push({ icon: 'ğŸ”€', text: '× ×™×”×•×œ ×’×¨×¡××•×ª ×œ×›×œ ×”×–×× ×” (version control)', priority: '×—×•×‘×”' });
  if (g('ver_mistake') !== '×œ×') recs.push({ icon: 'âš ï¸', text: '×¡×™××•×Ÿ ×’×¨×¡×” ×¤×¢×™×œ×” ×œ×× ×™×¢×ª ×©×’×™××•×ª', priority: '×—×•×‘×”' });
  
  // Catalog
  if (g('cat_search').includes('×§×©×”') || g('cat_search').includes('×œ× ××•×¦××ª')) recs.push({ icon: 'ğŸ”', text: '×× ×•×¢ ×—×™×¤×•×© ××¡××›×™× ××¨×›×–×™', priority: '×—×©×•×‘' });
  
  // Mobile
  if (g('mobile').includes('×—×©×•×‘') || g('mobile').includes('×§×¨×™×˜×™')) recs.push({ icon: 'ğŸ“±', text: '×××©×§ ××•×ª×× ×œ× ×™×™×“', priority: '×—×•×‘×”' });
  
  // Users
  if (g('sys_users').includes('×”×‘×•×¡')) recs.push({ icon: 'ğŸ‘”', text: '×“×©×‘×•×¨×“ ×¡×™×›×•× ×œ×× ×”×œ', priority: '×—×©×•×‘' });
  if (g('sys_users').includes('×¤×•×¨×˜×œ ×œ×§×•×—')) recs.push({ icon: 'ğŸŒ', text: '×¤×•×¨×˜×œ ×œ×§×•×— ×¢×¦×××™', priority: '×¢×ª×™×“×™' });

  const cardStyle = forEmail 
    ? 'background:#f8fafc;border-radius:10px;padding:16px 20px;margin-bottom:12px;border-right:4px solid #3b82f6;'
    : 'background:#f8fafc;border-radius:10px;padding:16px 20px;margin-bottom:12px;border-right:4px solid #3b82f6;';

  const recBadge = (p) => {
    const colors = { '×—×•×‘×”': '#dc2626', '×—×©×•×‘': '#d97706', '×¢×ª×™×“×™': '#6b7280' };
    const bg = { '×—×•×‘×”': '#fef2f2', '×—×©×•×‘': '#fffbeb', '×¢×ª×™×“×™': '#f9fafb' };
    return `<span style="background:${bg[p]};color:${colors[p]};border:1px solid ${colors[p]};padding:2px 10px;border-radius:20px;font-size:11px;font-weight:700;">${p}</span>`;
  };

  return `
  <div style="direction:rtl;font-family:'Segoe UI',Tahoma,sans-serif;background:#fff;">
    
    <!-- SUMMARY HEADER -->
    <div style="background:linear-gradient(135deg,#1e3a5f,#1e40af);padding:40px 50px;color:#fff;">
      <div style="font-size:13px;letter-spacing:2px;color:#93c5fd;margin-bottom:8px;">×¡×™×›×•× ××¤×™×•×Ÿ</div>
      <div style="font-size:28px;font-weight:800;margin-bottom:6px;">××” ×”××¢×¨×›×ª ×©×œ×š ×¦×¨×™×›×” ×œ×›×œ×•×œ</div>
      <div style="color:#bfdbfe;font-size:14px;">${date} | × ×•×¦×¨ ×¢×œ ×‘×¡×™×¡ ×”×©××œ×•×Ÿ ×©××™×œ××ª</div>
    </div>

    <div style="padding:40px 50px;">

      <!-- PAIN POINTS -->
      <div style="margin-bottom:36px;">
        <div style="font-size:18px;font-weight:800;color:#1e293b;margin-bottom:6px;padding-bottom:10px;border-bottom:3px solid #e2e8f0;">
          ğŸ˜¤ ×”×›××‘×™× ×”×¢×™×§×¨×™×™× ×©×¢×œ×•
        </div>
        <div style="margin-top:16px;">
          ${g('biggest_pain') !== 'â€”' ? '<div style="' + cardStyle + '">' + nl2br(g('biggest_pain')) + '</div>' : ''}
          ${g('missed_followup') !== '×œ×' && g('missed_followup') !== 'â€”' ? '<div style="' + cardStyle + '">×¤×¡×¤×•×¡ ××¢×§×‘ ×¢×œ ××™×™×œ×™×: <strong>' + g('missed_followup') + '</strong></div>' : ''}
          ${g('cat_search').includes('×§×©×”') || g('cat_search').includes('×œ× ××•×¦××ª') ? '<div style="' + cardStyle + '">×§×•×©×™ ×‘××¦×™××ª ××¡××›×™×: <strong>' + g('cat_search') + '</strong></div>' : ''}
          ${g('ver_mistake') !== '×œ×' && g('ver_mistake') !== 'â€”' ? '<div style="' + cardStyle + '">×©×’×™××•×ª ×’×¨×¡××•×ª: <strong>' + g('ver_mistake') + '</strong></div>' : ''}
        </div>
      </div>

      <!-- CURRENT PROCESS -->
      <div style="margin-bottom:36px;">
        <div style="font-size:18px;font-weight:800;color:#1e293b;margin-bottom:6px;padding-bottom:10px;border-bottom:3px solid #e2e8f0;">
          ğŸ”„ ×ª×”×œ×™×š ×”×¢×‘×•×“×” ×”× ×•×›×—×™
        </div>
        <div style="margin-top:16px;">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;">
            <div style="background:#f1f5f9;border-radius:10px;padding:16px;">
              <div style="color:#64748b;font-size:11px;margin-bottom:4px;">×”×–×× ×•×ª ×¤×ª×•×—×•×ª ×‘××§×‘×™×œ</div>
              <div style="font-size:20px;font-weight:800;color:#1e3a5f;">${g('open_orders')}</div>
            </div>
            <div style="background:#f1f5f9;border-radius:10px;padding:16px;">
              <div style="color:#64748b;font-size:11px;margin-bottom:4px;">×”×¦×¢×•×ª ××—×™×¨ ×¤×ª×•×—×•×ª</div>
              <div style="font-size:20px;font-weight:800;color:#1e3a5f;">${g('quote_open')}</div>
            </div>
            <div style="background:#f1f5f9;border-radius:10px;padding:16px;">
              <div style="color:#64748b;font-size:11px;margin-bottom:4px;">×ª×“×™×¨×•×ª ×¢×“×›×•×Ÿ ×œ×§×•×—×•×ª</div>
              <div style="font-size:16px;font-weight:700;color:#1e3a5f;">${g('customer_update_freq')}</div>
            </div>
            <div style="background:#f1f5f9;border-radius:10px;padding:16px;">
              <div style="color:#64748b;font-size:11px;margin-bottom:4px;">×©×™× ×•×™×™ ×’×¨×¡××•×ª</div>
              <div style="font-size:16px;font-weight:700;color:#1e3a5f;">${g('ver_freq')}</div>
            </div>
          </div>
          ${g('order_flow') !== 'â€”' ? `
          <div style="margin-top:14px;">
            <div style="font-weight:600;color:#334155;font-size:14px;margin-bottom:8px;">××¡×¢ ×”×–×× ×”:</div>
            <div style="background:#f8fafc;border-right:4px solid #3b82f6;padding:12px 16px;border-radius:0 8px 8px 0;font-size:13px;line-height:1.8;white-space:pre-wrap;">${g('order_flow')}</div>
          </div>` : ''}
        </div>
      </div>

      <!-- VERSION 1 REQUIREMENTS -->
      <div style="margin-bottom:36px;">
        <div style="font-size:18px;font-weight:800;color:#1e293b;margin-bottom:6px;padding-bottom:10px;border-bottom:3px solid #e2e8f0;">
          âœ… ××” ×—×™×™×‘ ×œ×”×™×•×ª â€” Version 1
        </div>
        <div style="margin-top:16px;">
          ${g('must_have') !== 'â€”' ? '<div style="' + cardStyle + '">' + nl2br(g('must_have')) + '</div>' : '<div style="color:#94a3b8;font-style:italic;">×œ× ×¦×•×™×Ÿ</div>'}
        </div>
      </div>

      <!-- FUTURE -->
      ${g('nice_to_have') !== 'â€”' ? `
      <div style="margin-bottom:36px;">
        <div style="font-size:18px;font-weight:800;color:#1e293b;margin-bottom:6px;padding-bottom:10px;border-bottom:3px solid #e2e8f0;">
          ğŸ”® Version 2 â€” ×œ×¢×ª×™×“
        </div>
        <div style="margin-top:16px;">
          <div style="background:#f0fdf4;border-right:4px solid #10b981;padding:12px 16px;border-radius:0 8px 8px 0;font-size:13px;line-height:1.8;">${nl2br(g('nice_to_have'))}</div>
        </div>
      </div>` : ''}

      <!-- RECOMMENDATIONS -->
      <div style="margin-bottom:36px;">
        <div style="font-size:18px;font-weight:800;color:#1e293b;margin-bottom:6px;padding-bottom:10px;border-bottom:3px solid #e2e8f0;">
          ğŸ› ï¸ ×”××œ×¦×•×ª ×œ××¢×¨×›×ª â€” ×¢×œ ×‘×¡×™×¡ ×”×ª×©×•×‘×•×ª ×©×œ×š
        </div>
        <div style="margin-top:16px;">
          <!-- Always recommended -->
          ${['× ×™×”×•×œ ×”×–×× ×•×ª ×¢× ×¡×˜×˜×•×¡×™× ××•×ª×××™× ××™×©×™×ª','×›×¨×˜×™×¡ ×œ×§×•×— + ×”×™×¡×˜×•×¨×™×™×ª ×”×–×× ×•×ª','×›×¨×˜×™×¡ ×¡×¤×§ + ×‘×™×¦×•×¢×™×','××¢×§×‘ ××¡××›×™× ×œ×›×œ ×”×–×× ×”','×“×©×‘×•×¨×“ â€” ×›×œ ×”×”×–×× ×•×ª ×”×¤×ª×•×—×•×ª ×‘××‘×˜ ××—×“'].map(t=>`
            <div style="display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-radius:10px;background:#f8fafc;margin-bottom:8px;">
              <span style="font-size:14px;color:#1e293b;">ğŸ“‹ ${t}</span>
              ${recBadge('×—×•×‘×”')}
            </div>
          `).join('')}
          <!-- Dynamic recommendations -->
          ${recs.map(r=>`
            <div style="display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-radius:10px;background:#f8fafc;margin-bottom:8px;">
              <span style="font-size:14px;color:#1e293b;">${r.icon} ${r.text}</span>
              ${recBadge(r.priority)}
            </div>
          `).join('')}
        </div>
      </div>

      <!-- USERS & MOBILE -->
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:24px;">
        <div style="background:#f1f5f9;border-radius:12px;padding:20px;">
          <div style="color:#64748b;font-size:12px;margin-bottom:8px;">ğŸ‘¥ ××©×ª××©×™×</div>
          <div style="font-size:14px;font-weight:600;color:#1e293b;">${g('sys_users')}</div>
        </div>
        <div style="background:#f1f5f9;border-radius:12px;padding:20px;">
          <div style="color:#64748b;font-size:12px;margin-bottom:8px;">ğŸ“± × ×™×™×“</div>
          <div style="font-size:14px;font-weight:600;color:#1e293b;">${g('mobile')}</div>
        </div>
      </div>

      <div style="color:#94a3b8;font-size:11px;text-align:center;margin-top:32px;padding-top:16px;border-top:1px solid #e2e8f0;">
        ××¡××š ×–×” ×”×•×¤×§ ××•×˜×•××˜×™×ª ×¢×œ ×‘×¡×™×¡ ×”×©××œ×•×Ÿ ×©××™×œ××ª | ${date}
      </div>
    </div>
  </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PDF GENERATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildPdfHtml() {
  const unanswered = getUnanswered();
  const timeTaken = state.endTime && state.startTime ? formatTime(state.endTime - state.startTime) : "×œ× × ××“×“";
  const date = new Date().toLocaleDateString('he-IL', { year:'numeric', month:'long', day:'numeric' });
  const businessName = getVal('business_name') || getVal('cat_structure') || "×œ×§×•×— CRM";

  let sectionsHtml = '';
  STEPS.forEach(step => {
    sectionsHtml += `
      <div class="pdf-section-header" style="display:flex;align-items:center;gap:12px;background:linear-gradient(135deg,#1e3a5f,#1e40af);color:#fff;padding:16px 24px;border-radius:12px;margin-bottom:20px;margin-top:30px;page-break-before:auto;">
        <span style="font-size:22px;">${step.icon}</span>
        <span style="font-size:17px;font-weight:700;">${step.title}</span>
      </div>
    `;
    step.questions.forEach(q => {
      const val = getVal(q.id);
      const isEmpty = !val;
      sectionsHtml += `
        <div style="margin-bottom:18px;page-break-inside:avoid;">
          <div style="font-weight:600;color:#334155;font-size:13px;margin-bottom:6px;">${q.label}</div>
          <div style="background:${isEmpty?'#fafafa':'#f8fafc'};border-right:4px solid ${isEmpty?'#e2e8f0':'#3b82f6'};padding:10px 16px;border-radius:0 8px 8px 0;color:${isEmpty?'#94a3b8':'#1e293b'};font-size:13px;line-height:1.7;${isEmpty?'font-style:italic;':''}white-space:pre-wrap;">
            ${isEmpty ? 'â€” ×œ× ××•×œ× â€”' : val.replace(/</g,'&lt;')}
          </div>
        </div>
      `;
    });
  });

  const unansweredHtml = unanswered.length > 0 ? `
    <div style="background:#fef9c3;border:2px solid #fde047;border-radius:12px;padding:20px;margin-top:30px;page-break-inside:avoid;">
      <h3 style="color:#854d0e;margin-bottom:14px;font-size:16px;">âš ï¸ ×©××œ×•×ª ×©×œ× ××•×œ××• (${unanswered.length})</h3>
      ${unanswered.map(u => `
        <div style="background:#fff;border-right:3px solid #fbbf24;padding:8px 12px;margin-bottom:8px;border-radius:0 6px 6px 0;font-size:13px;color:#92400e;">
          <span style="font-weight:600;">${u.icon} ${u.step}:</span> ${u.question}
        </div>
      `).join('')}
    </div>
  ` : `<div style="background:#dcfce7;border:2px solid #86efac;border-radius:12px;padding:16px 20px;margin-top:30px;color:#166534;font-weight:600;">âœ… ×›×œ ×”×©××œ×•×ª ××•×œ××• â€” ×ª×©×•×‘×•×ª ××œ××•×ª!</div>`;

  return `
  <div style="direction:rtl;font-family:'Heebo',Arial,sans-serif;background:#fff;width:100%;unicode-bidi:plaintext;">
    
    <!-- COVER PAGE -->
    <div style="background:linear-gradient(135deg,#0f172a,#1e3a5f);padding:60px 50px;min-height:270mm;display:flex;flex-direction:column;justify-content:space-between;page-break-after:always;">
      <div>
        <div style="font-size:60px;margin-bottom:24px;">ğŸ—‚ï¸</div>
        <div style="color:#fff;font-size:34px;font-weight:800;margin-bottom:8px;">××¡××š ××¤×™×•×Ÿ</div>
        <div style="color:#93c5fd;font-size:20px;margin-bottom:48px;">××¢×¨×›×ª CRM ×œ× ×™×”×•×œ ×¨×›×© ×•×™×‘×•×</div>
        
        <div style="background:rgba(255,255,255,0.08);border-radius:16px;padding:28px;border:1px solid rgba(255,255,255,0.15);">
          <div style="color:#60a5fa;font-size:12px;letter-spacing:2px;margin-bottom:16px;">×¤×¨×˜×™ ×œ×§×•×—</div>
          <div style="color:#94a3b8;font-size:13px;margin-bottom:4px;">×¢×¡×§</div>
          <div style="color:#fff;font-size:18px;font-weight:600;margin-bottom:16px;">${businessName}</div>
          <div style="color:#94a3b8;font-size:13px;margin-bottom:4px;">×ª××¨×™×š</div>
          <div style="color:#fff;font-size:16px;">${date}</div>
        </div>
      </div>
      
      <div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:20px;">
          ${STEPS.map(s=>`<span style="background:rgba(59,130,246,0.2);border:1px solid rgba(59,130,246,0.4);color:#93c5fd;padding:5px 12px;border-radius:20px;font-size:11px;">${s.icon} ${s.title}</span>`).join('')}
        </div>
        <div style="color:#475569;font-size:12px;">×”×•×¤×§ ×¢"×™ ××¢×¨×›×ª ××¤×™×•×Ÿ CRM ××•×˜×•××˜×™×ª | ${RECIPIENT_EMAIL}</div>
      </div>
    </div>

    <!-- STATS PAGE -->
    <div style="padding:40px 50px;page-break-after:always;">
      <div style="font-size:22px;font-weight:800;color:#1e293b;margin-bottom:24px;padding-bottom:12px;border-bottom:3px solid #e2e8f0;">ğŸ“Š ×¡×™×›×•× ×˜×›× ×™</div>
      
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:28px;">
        <div style="background:#f1f5f9;border-radius:12px;padding:20px;text-align:center;">
          <div style="color:#64748b;font-size:12px;margin-bottom:8px;">×–××Ÿ ××™×œ×•×™ ×”×©××œ×•×Ÿ</div>
          <div style="font-size:22px;font-weight:800;color:#1e3a5f;">${timeTaken}</div>
        </div>
        <div style="background:${unanswered.length>0?'#fef9c3':'#dcfce7'};border-radius:12px;padding:20px;text-align:center;">
          <div style="color:#64748b;font-size:12px;margin-bottom:8px;">×©××œ×•×ª ×œ× ××•×œ××•</div>
          <div style="font-size:22px;font-weight:800;color:${unanswered.length>0?'#854d0e':'#166534'};">${unanswered.length}</div>
        </div>
        <div style="background:#f1f5f9;border-radius:12px;padding:20px;text-align:center;">
          <div style="color:#64748b;font-size:12px;margin-bottom:8px;">×©××œ×•×ª ×©××•×œ××•</div>
          <div style="font-size:22px;font-weight:800;color:#1e293b;">${STEPS.reduce((a,s)=>a+s.questions.length,0) - unanswered.length} / ${STEPS.reduce((a,s)=>a+s.questions.length,0)}</div>
        </div>
        <div style="background:#f1f5f9;border-radius:12px;padding:20px;text-align:center;">
          <div style="color:#64748b;font-size:12px;margin-bottom:8px;">×ª××¨×™×š ××™×œ×•×™</div>
          <div style="font-size:16px;font-weight:700;color:#1e293b;">${date}</div>
        </div>
      </div>

      <div style="background:#f8fafc;border-radius:12px;padding:24px;margin-bottom:24px;">
        <div style="font-weight:700;color:#1e293b;margin-bottom:14px;font-size:15px;">ğŸ” ××ª×’×¨×™× ×©×¢×œ×• ×‘×©×™×—×ª ×”×”×™×›×¨×•×ª:</div>
        ${KNOWN_INFO.challenges.map(c=>`
          <div style="display:flex;gap:10px;align-items:flex-start;margin-bottom:8px;font-size:13px;color:#374151;">
            <span style="color:#3b82f6;margin-top:2px;">â€¢</span><span>${c}</span>
          </div>
        `).join('')}
      </div>

      ${unansweredHtml}
    </div>

    <!-- SUMMARY PAGE (what client sees) -->
    <div style="page-break-before:always;">
      ${generateSummaryHtml()}
    </div>

    <!-- ANSWERS PAGES (full Q&A) -->
    <div style="padding:40px 50px;page-break-before:always;">
      <div style="font-size:22px;font-weight:800;color:#1e293b;margin-bottom:8px;padding-bottom:12px;border-bottom:3px solid #e2e8f0;">ğŸ“‹ ×ª×©×•×‘×•×ª ××¤×•×¨×˜×•×ª</div>
      ${sectionsHtml}
      <div style="color:#94a3b8;font-size:11px;text-align:center;margin-top:40px;padding-top:20px;border-top:1px solid #e2e8f0;">
        ××¡××š ×–×” ×”×•×¤×§ ××•×˜×•××˜×™×ª ×¢"×™ ××¢×¨×›×ª ××¤×™×•×Ÿ CRM | ${date}
      </div>
    </div>
  </div>`;
}

async function generatePDFBlob() {
  const pdfContainer = document.getElementById('pdf-template');
  pdfContainer.innerHTML = buildPdfHtml();
  pdfContainer.style.display = 'block';

  // Wait for Heebo font to load
  try { await document.fonts.ready; } catch(e) {}

  const opt = {
    margin: 0,
    filename: 'crm-spec.pdf',
    image: { type: 'jpeg', quality: 0.95 },
    html2canvas: { 
      scale: 2, useCORS: true, letterRendering: true, allowTaint: true,
      onclone: (doc) => {
        // Ensure RTL in cloned doc
        doc.documentElement.setAttribute('dir', 'rtl');
        doc.documentElement.setAttribute('lang', 'he');
      }
    },
    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
  };

  const blob = await html2pdf().set(opt).from(pdfContainer).outputPdf('blob');
  pdfContainer.style.display = 'none';
  return blob;
}

async function generateAndDownloadPDF() {
  const date = new Date().toLocaleDateString('he-IL').replace(/\//g, '-');
  const blob = await generatePDFBlob();
  // Trigger download
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = '××¤×™×•×Ÿ-CRM-' + date + '.pdf';
  a.click();
  URL.revokeObjectURL(url);
  return true;
}

async function pdfToBase64(blob) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result.split(',')[1]);
    reader.onerror = reject;
    reader.readAsDataURL(blob);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  EMAIL VIA N8N WEBHOOK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function sendToN8n() {
  setState({ emailStatus: 'sending' });
  const unanswered = getUnanswered();
  const timeTaken = state.endTime && state.startTime ? formatTime(state.endTime - state.startTime) : "×œ× × ××“×“";

  const allAnswers = {};
  STEPS.forEach(step => {
    step.questions.forEach(q => {
      const v = state.answers[q.id];
      allAnswers[q.id] = {
        question: q.label,
        section: step.title,
        answer: Array.isArray(v) ? v.join(', ') : (v || '')
      };
    });
  });

  // Build full Q&A text for email
  let qaText = '';
  STEPS.forEach(step => {
    qaText += '\n\n--- ' + step.icon + ' ' + step.title + ' ---\n';
    step.questions.forEach(q => {
      const v = state.answers[q.id];
      const ans = Array.isArray(v) ? v.join(', ') : (v || '×œ× ××•×œ×');
      qaText += '\n×©××œ×”: ' + q.label + '\n×ª×©×•×‘×”: ' + ans + '\n';
    });
  });

  // Generate PDF and convert to base64
  let pdfBase64 = null;
  try {
    const pdfBlob = await generatePDFBlob();
    pdfBase64 = await pdfToBase64(pdfBlob);
    // Also trigger download for the client
    const url = URL.createObjectURL(pdfBlob);
    const a = document.createElement('a');
    a.href = url;
    a.download = '××¤×™×•×Ÿ-CRM-' + new Date().toLocaleDateString('he-IL').replace(/\//g,'-') + '.pdf';
    a.click();
    URL.revokeObjectURL(url);
  } catch(e) {
    console.warn('PDF generation failed:', e);
  }

  const payload = {
    recipient: RECIPIENT_EMAIL,
    date: new Date().toLocaleDateString('he-IL'),
    timestamp: new Date().toISOString(),
    timeTaken,
    totalQuestions: STEPS.reduce((a,s)=>a+s.questions.length,0),
    unansweredCount: unanswered.length,
    unanswered: unanswered.map(u => u.icon + ' ' + u.step + ': ' + u.question),
    qaText,
    businessName: getVal('cat_structure') || '×œ× ×¦×•×™×Ÿ',
    mustHave: getVal('must_have') || '×œ× ×¦×•×™×Ÿ',
    biggestPain: getVal('biggest_pain') || '×œ× ×¦×•×™×Ÿ',
    pdfBase64: pdfBase64
  };

  try {
    const res = await fetch(N8N_WEBHOOK_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    if (!res.ok) throw new Error('Status ' + res.status);
    setState({ emailStatus: 'success' });
  } catch (err) {
    console.error('Webhook error:', err);
    setState({ emailStatus: 'error' });
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function render() {
  const app = document.getElementById('app');
  if (state.screen === 'intro') app.innerHTML = renderIntro();
  else if (state.screen === 'quiz') app.innerHTML = renderQuiz();
  else app.innerHTML = renderResult();
  attachEvents();
  // Update top progress bar
  const fill = document.getElementById('top-bar-fill');
  if (fill) {
    const pct = state.screen === 'result' ? 100
      : state.screen === 'quiz' ? Math.round((state.step / STEPS.length) * 95)
      : 0;
    fill.style.width = pct + '%';
  }
}

// â”€â”€â”€ INTRO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderIntro() {
  return `
  <div style="text-align:center;margin-bottom:40px;padding-top:8px;animation:fadeInUp 0.4s ease both;">
    <div style="display:inline-flex;align-items:center;justify-content:center;width:64px;height:64px;border-radius:18px;background:var(--blue-light);border:1px solid #bfdbfe;font-size:30px;margin-bottom:16px;">ğŸ—‚ï¸</div>
    <div class="eyebrow">××¤×™×•×Ÿ ××¢×¨×›×ª</div>
    <h1>CRM ×œ× ×™×”×•×œ ×¨×›×© ×•×™×‘×•×</h1>
  </div>

  <div class="glass" style="animation:fadeInUp 0.4s ease 0.06s both;">
    <div class="eyebrow" style="margin-bottom:16px;">××” ×©×”×‘× ×• ××”×©×™×—×”</div>
    <div class="info-row">
      <span class="info-label">×¢×¡×§</span>
      <span class="info-value">×—×‘×¨×” ×”×¢×•×¡×§×ª ×‘×™×™×‘×•× ×•×¨×›×© ×‘×™× ×œ××•××™</span>
    </div>
    <div class="info-row">
      <span class="info-label">×ª×¤×§×™×“</span>
      <span class="info-value">×× ×”×œ×ª ×¨×›×©</span>
    </div>
    <div class="info-row">
      <span class="info-label">×›×œ×™×</span>
      <span class="info-value">××™×™×œ×™×, ××§×¡×œ, ×•×•××˜×¡××¤</span>
    </div>
    <hr class="divider">
    <div style="font-size:11px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--slate-400);margin-bottom:14px;">××ª×’×¨×™× ×©×¢×œ×• ×‘×©×™×—×”</div>
    ${KNOWN_INFO.challenges.map((c,i)=>`
      <div class="challenge-item" style="animation:fadeInUp 0.3s ease ${0.04*i}s both;">
        <div class="challenge-dot"></div>
        <span style="color:var(--slate-700);font-size:13px;">${c}</span>
      </div>
    `).join('')}
  </div>

  <div class="glass" style="animation:fadeInUp 0.4s ease 0.1s both;">
    <div class="eyebrow" style="color:var(--green);margin-bottom:14px;">××˜×¨×ª ×”×©××œ×•×Ÿ</div>
    <p style="color:var(--slate-600);line-height:1.8;font-size:14px;">
      ×”×©××œ×•×Ÿ × ×•×¢×“ ×œ×¢×–×•×¨ ×œ× ×• ×œ×”×‘×™×Ÿ ×œ×¢×•××§ ××ª ××•×¤×Ÿ ×”×¢×‘×•×“×” ×©×œ×š â€” ××™×š ×× ×”×œ×™× ×”×–×× ×•×ª, ×¡×¤×§×™×, ××¡××›×™× ×•×ª×§×©×•×¨×ª ×¢× ×œ×§×•×—×•×ª.
      <br><br>
      ×¢×œ ×‘×¡×™×¡ ×ª×©×•×‘×•×ª×™×™×š × ×‘× ×” ×¢×‘×•×¨×š <strong style="color:var(--navy);">××¡××š ××¤×™×•×Ÿ ××¡×•×“×¨</strong> ×©×™×’×“×™×¨ ×‘×“×™×•×§ ××” ×”××¢×¨×›×ª ×¦×¨×™×›×” ×œ×›×œ×•×œ â€” ××” ×—×™×•× ×™ ×œ×’×¨×¡×” ×”×¨××©×•× ×” ×•××” × ×™×ª×Ÿ ×œ×”×•×¡×™×£ ×‘×”××©×š.
    </p>
  </div>

  <div class="glass" style="animation:fadeInUp 0.4s ease 0.14s both;margin-bottom:24px;">
    <div style="font-size:11px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--slate-400);margin-bottom:14px;">6 × ×•×©××™×</div>
    <div>${STEPS.map(s=>`<span class="topic-badge">${s.icon} ${s.title}</span>`).join('')}</div>
  </div>

  ${state.hasBackup ? `
  <div class="backup-banner" style="animation:fadeInUp 0.3s ease both;">
    <div style="font-size:22px;margin-bottom:8px;">ğŸ’¾</div>
    <div style="color:var(--blue);font-weight:700;font-size:15px;margin-bottom:4px;">× ××¦× ×©××œ×•×Ÿ ×©××•×¨</div>
    <div style="color:var(--slate-500);font-size:13px;margin-bottom:16px;">×”×× ×ª×¨×¦×™ ×œ×”××©×™×š ×××™×¤×” ×©×”×¤×¡×§×ª?</div>
    <div style="display:flex;justify-content:center;gap:10px;">
      <button class="btn btn-primary" onclick="restoreBackup()">×”××©×™×›×™ â†</button>
      <button class="btn btn-outline" onclick="discardBackup()">×”×ª×—×™×œ×™ ××—×“×©</button>
    </div>
  </div>` : ''}

  <div style="text-align:center;animation:fadeInUp 0.4s ease 0.18s both;">
    <button class="btn btn-primary btn-large" onclick="startQuiz()">
      ×‘×•××™ × ×ª×—×™×œ &nbsp;â†
    </button>
    <p style="color:var(--slate-400);font-size:13px;margin-top:12px;">×œ×—×¦×™ ×›×©××ª ××•×›× ×”</p>
  </div>`;
}

// â”€â”€â”€ QUIZ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderQuiz() {
  const step = STEPS[state.step];

  const qs = step.questions.map(q => {
    const val = state.answers[q.id];
    let field = '';
    if (q.type === 'text') {
      field = `<input type="text" value="${(val||'').replace(/"/g,'&quot;')}" placeholder="${q.placeholder||''}" oninput="setAnswer('${q.id}',this.value,true)">`;
    } else if (q.type === 'textarea') {
      field = `<textarea rows="4" placeholder="${q.placeholder||''}" oninput="setAnswer('${q.id}',this.value,true)">${val||''}</textarea>`;
    } else if (q.type === 'select') {
      field = `<select onchange="setAnswer('${q.id}',this.value)">
        <option value="">-- ×‘×—×¨/×™ --</option>
        ${q.options.map(o=>`<option value="${o}" ${val===o?'selected':''}>${o}</option>`).join('')}
      </select>`;
    } else if (q.type === 'chips') {
      const sel = Array.isArray(val) ? val : [];
      field = `<div class="chips">${q.options.map(o=>`
        <button class="chip ${sel.includes(o)?'active':''}" onclick="toggleChip('${q.id}','${o}')">${sel.includes(o)?'âœ“ ':''}${o}</button>
      `).join('')}</div>`;
    }
    return `<div class="q-item"><label class="label">${q.label}</label>${field}</div>`;
  }).join('');

  const pills = STEPS.map((s,i)=>`
    <div class="pill ${i<state.step?'done':i===state.step?'active':'todo'}" 
      ${i<state.step?`onclick="goStep(${i})"`:''}>${i<state.step?'âœ“':s.icon} ${s.title}</div>
  `).join('');

  return `
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;">
    <div class="step-pills" style="margin-bottom:0;">${pills}</div>
    <button class="btn-ghost" onclick="setState({screen:'intro'})">â† ×—×–×¨×”</button>
  </div>
  <div class="card">
    <div class="card-header">
      <div style="display:flex;align-items:center;justify-content:space-between;">
        <h2 style="color:var(--navy);">${step.icon}&nbsp; ${step.title}</h2>
        <span style="font-size:12px;font-weight:500;color:var(--slate-400);background:var(--surface-2);padding:4px 10px;border-radius:100px;border:1px solid var(--border);">${state.step+1} / ${STEPS.length}</span>
      </div>
    </div>
    <div class="card-body">
      <div class="q-group">${qs}</div>
      <div class="nav">
        <button class="btn btn-outline" onclick="${state.step>0?`goStep(${state.step-1})`:"setState({screen:'intro'})"}">â†’ ×”×§×•×“×</button>
        ${state.step < STEPS.length-1
          ? `<button class="btn btn-primary" onclick="goStep(${state.step+1})">×”×‘× â†</button>`
          : `<button class="btn btn-success" onclick="finishQuiz()">×¡×™×•× ×•×©×œ×™×—×” âœ“</button>`
        }
      </div>
    </div>
  </div>`;
}

// â”€â”€â”€ RESULT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderResult() {
  const unanswered = getUnanswered();
  const timeTaken = state.endTime && state.startTime ? formatTime(state.endTime - state.startTime) : "â€”";
  const totalQ = STEPS.reduce((a,s)=>a+s.questions.length,0);
  const answered = totalQ - unanswered.length;

  let statusHtml = '';
  if (state.emailStatus === 'sending') {
    statusHtml = `<div class="status-box status-sending"><div class="spinner"></div><span>×©×•×œ×— ×œ××œ×™×™×©××¢...</span></div>`;
  } else if (state.emailStatus === 'success') {
    statusHtml = `<div class="status-box status-success"><span>âœ“</span><span>× ×©×œ×— ×‘×”×¦×œ×—×” ×œ××œ×™×™×©××¢!</span></div>`;
  } else if (state.emailStatus === 'error') {
    statusHtml = `<div class="status-box status-error"><span>âš </span><div>×œ× ×”×¦×œ×—× ×• ×œ×©×œ×•×— â€” PDF ×”×•×¨×“ ×œ××—×©×‘ ×©×œ×š.<br><small style="opacity:0.7;">×•×“× ×©×”-Webhook ×‘-n8n ×¤×¢×™×œ.</small></div></div>`;
  }

  const unansweredHtml = unanswered.length > 0
    ? `<div class="unanswered-box">
        <div style="font-weight:700;color:#fbbf24;margin-bottom:10px;font-size:13px;">âš  ×©××œ×•×ª ×©×œ× ××•×œ××• (${unanswered.length})</div>
        ${unanswered.map(u=>`<div class="unanswered-item">${u.icon} <strong>${u.step}:</strong> ${u.question}</div>`).join('')}
       </div>`
    : `<div class="all-answered">âœ“ &nbsp;×›×œ ×”×©××œ×•×ª ××•×œ××•!</div>`;

  return `
  <div class="card" style="animation:fadeInUp 0.4s ease both;">
    <div class="result-header">
      <div style="display:inline-flex;align-items:center;justify-content:center;width:56px;height:56px;border-radius:50%;background:#d1fae5;border:2px solid #6ee7b7;font-size:26px;margin-bottom:14px;">âœ“</div>
      <h2>××¡××š ×”××¤×™×•×Ÿ ××•×›×Ÿ!</h2>
      <p>×ª×•×“×” â€” ×”× ×” ×”×¤×¢×•×œ×•×ª ×”×‘××•×ª</p>
    </div>
    <div class="card-body">
      ${statusHtml}

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px;">
        <div class="stat-box">
          <div class="stat-label">×–××Ÿ ××™×œ×•×™</div>
          <div class="stat-value">${timeTaken}</div>
        </div>
        <div class="stat-box">
          <div class="stat-label">×©××œ×•×ª ×©× ×¢× ×•</div>
          <div class="stat-value" style="color:${unanswered.length===0?'var(--emerald-400)':'#fbbf24'};">
            ${answered}<span style="font-size:14px;font-weight:400;color:var(--slate-500);"> / ${totalQ}</span>
          </div>
        </div>
      </div>

      ${unansweredHtml}

      <div class="action-btns" style="margin-top:24px;">
        <button class="btn btn-primary" onclick="downloadPDF()" id="pdf-btn">
          ×”×•×¨×“ PDF
        </button>
        <button class="btn btn-outline" onclick="clearBackup();setState({screen:'intro',step:0,answers:{},startTime:null,endTime:null,emailStatus:'idle',hasBackup:false})">
          ××œ××™ ××—×“×©
        </button>
      </div>
    </div>
  </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  EVENTS & ACTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function attachEvents() {}

function startQuiz() {
  state.startTime = Date.now();
  setState({ screen: 'quiz', step: 0 });
}
function restoreBackup() {
  const data = state._backupData;
  if (data) {
    state.answers = data.answers;
    state.startTime = data.startTime;
    state.hasBackup = false;
    setState({ screen: 'quiz', step: 0 });
  }
}
function discardBackup() {
  clearBackup();
  state.hasBackup = false;
  state._backupData = null;
  render();
}
function goStep(i) { setState({ step: i }); }
function finishQuiz() {
  state.endTime = Date.now();
  setState({ screen: 'result' });
  // Auto-send to n8n (includes PDF generation + download)
  if (N8N_WEBHOOK_URL && !N8N_WEBHOOK_URL.includes('YOUR-N8N')) {
    sendToN8n();
  } else {
    // If no webhook, just download the PDF
    generateAndDownloadPDF();
  }
}
async function downloadPDF() {
  const btn = document.getElementById('pdf-btn');
  if (btn) { btn.disabled = true; btn.textContent = 'â³ ××™×™×¦×¨ PDF...'; }
  try {
    await generateAndDownloadPDF();
    if (btn) { btn.disabled = false; btn.textContent = 'âœ… PDF ×”×•×¨×“!'; }
  } catch(e) {
    if (btn) { btn.disabled = false; btn.textContent = 'ğŸ“¥ ×”×•×¨×“ PDF'; }
    console.error(e);
  }
}

// Expose to global scope for inline event handlers
window.startQuiz = startQuiz;
window.restoreBackup = restoreBackup;
window.discardBackup = discardBackup;
window.goStep = goStep;
window.finishQuiz = finishQuiz;
window.downloadPDF = downloadPDF;
window.sendToN8n = sendToN8n;
window.setState = setState;
window.setAnswer = setAnswer;
window.toggleChip = toggleChip;
window.clearBackup = clearBackup;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
render();
</script>
</body>
</html>
