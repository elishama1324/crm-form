<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>××¤×™×•×Ÿ ××¢×¨×›×ª CRM</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  direction: rtl; background: linear-gradient(160deg, #0f172a 0%, #1e3a5f 60%, #0f172a 100%);
  min-height: 100vh; padding: 20px;
}
.container { max-width: 760px; margin: 0 auto; }
.card {
  background: #fff; border-radius: 20px;
  box-shadow: 0 25px 60px rgba(0,0,0,0.4); overflow: hidden; margin-bottom: 20px;
}
.card-header {
  background: linear-gradient(135deg, #1e3a5f, #1e40af);
  padding: 24px 30px; color: #fff;
}
.card-body { padding: 30px; }
.glass {
  background: rgba(255,255,255,0.06); backdrop-filter: blur(10px);
  border-radius: 18px; border: 1px solid rgba(255,255,255,0.12);
  padding: 28px; margin-bottom: 20px;
}
h1 { color: #fff; font-size: 28px; font-weight: 800; }
h2 { font-size: 20px; font-weight: 700; }
h3 { font-size: 16px; font-weight: 600; margin-bottom: 14px; }
.subtitle { color: #94a3b8; font-size: 14px; margin-top: 6px; }
.label { display: block; font-weight: 600; color: #1e293b; margin-bottom: 10px; font-size: 15px; }
input[type=text], textarea, select {
  width: 100%; padding: 12px 16px; border-radius: 10px;
  border: 2px solid #e2e8f0; font-size: 15px; font-family: inherit;
  outline: none; background: #fff; direction: rtl; transition: border 0.2s;
}
input[type=text]:focus, textarea:focus, select:focus { border-color: #1e3a5f; }
textarea { resize: vertical; line-height: 1.6; }
.q-group { display: flex; flex-direction: column; gap: 24px; }
.chips { display: flex; flex-wrap: wrap; gap: 10px; }
.chip {
  padding: 8px 16px; border-radius: 20px; border: 2px solid #e2e8f0;
  background: #fff; color: #374151; font-size: 14px; cursor: pointer;
  font-family: inherit; transition: all 0.15s;
}
.chip.active { background: #1e3a5f; border-color: #1e3a5f; color: #fff; }
.nav { display: flex; justify-content: space-between; margin-top: 32px; padding-top: 24px; border-top: 2px solid #f1f5f9; }
.btn {
  padding: 12px 28px; border-radius: 10px; font-size: 15px;
  font-family: inherit; font-weight: 600; cursor: pointer; transition: all 0.2s; border: none;
}
.btn-primary { background: #1e3a5f; color: #fff; box-shadow: 0 4px 15px rgba(30,58,95,0.4); }
.btn-primary:hover { background: #1e40af; }
.btn-success { background: linear-gradient(135deg, #059669, #10b981); color: #fff; }
.btn-outline { background: #fff; color: #475569; border: 2px solid #e2e8f0; }
.btn-large { padding: 16px 48px; font-size: 17px; border-radius: 14px; }
.progress-bar-bg { background: rgba(255,255,255,0.1); height: 6px; border-radius: 3px; margin-bottom: 16px; }
.progress-bar { height: 100%; border-radius: 3px; background: linear-gradient(90deg, #3b82f6, #60a5fa); transition: width 0.4s ease; }
.step-pills { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 20px; }
.pill {
  padding: 5px 12px; border-radius: 20px; font-size: 12px;
  display: flex; align-items: center; gap: 4px; transition: all 0.2s; cursor: default;
}
.pill.done { background: rgba(52,211,153,0.15); color: #34d399; border: 1px solid #34d399; cursor: pointer; }
.pill.active { background: #3b82f6; color: #fff; border: 1px solid #3b82f6; }
.pill.todo { background: rgba(255,255,255,0.05); color: #64748b; border: 1px solid rgba(255,255,255,0.08); }
.topic-badge {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 8px 16px; border-radius: 20px;
  background: rgba(59,130,246,0.15); border: 1px solid rgba(59,130,246,0.3);
  color: #93c5fd; font-size: 13px; margin: 4px;
}
.info-row { display: flex; gap: 8px; align-items: flex-start; margin-bottom: 8px; color: #cbd5e1; font-size: 14px; }
.info-label { color: #94a3b8; white-space: nowrap; }
.challenge-item { display: flex; gap: 8px; align-items: flex-start; margin-bottom: 6px; }
.challenge-dot { color: #3b82f6; margin-top: 3px; }
.result-header { background: linear-gradient(135deg, #059669, #10b981); padding: 30px; text-align: center; }
.result-header h2 { color: #fff; font-size: 24px; margin-bottom: 8px; }
.result-header p { color: #d1fae5; font-size: 14px; }
.action-btns { display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap; }
.status-box {
  padding: 16px 20px; border-radius: 12px; margin-bottom: 16px;
  display: flex; align-items: center; gap: 12px; font-size: 14px;
}
.status-sending { background: #fef9c3; color: #854d0e; border: 1px solid #fde047; }
.status-success { background: #dcfce7; color: #166534; border: 1px solid #86efac; }
.status-error { background: #fef2f2; color: #991b1b; border: 1px solid #fca5a5; }
.spinner { width: 18px; height: 18px; border: 2px solid currentColor; border-top-color: transparent; border-radius: 50%; animation: spin 0.7s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }
.hidden { display: none; }

/* â”€â”€â”€ PDF TEMPLATE STYLES â”€â”€â”€ */
#pdf-template {
  display: none; direction: rtl; font-family: 'Segoe UI', Tahoma, sans-serif;
  background: #fff; padding: 0; width: 210mm; color: #1e293b;
}
.pdf-cover {
  background: linear-gradient(135deg, #0f172a, #1e3a5f);
  padding: 60px 50px; min-height: 297mm; display: flex; flex-direction: column;
  justify-content: space-between;
}
.pdf-cover-logo { font-size: 64px; margin-bottom: 20px; }
.pdf-cover-title { color: #fff; font-size: 32px; font-weight: 800; margin-bottom: 8px; }
.pdf-cover-sub { color: #93c5fd; font-size: 18px; margin-bottom: 40px; }
.pdf-cover-client { background: rgba(255,255,255,0.1); border-radius: 16px; padding: 28px; border: 1px solid rgba(255,255,255,0.2); }
.pdf-cover-client h3 { color: #60a5fa; font-size: 13px; letter-spacing: 2px; margin-bottom: 16px; }
.pdf-cover-meta { color: #fff; font-size: 16px; margin-bottom: 10px; }
.pdf-cover-meta span { color: #94a3b8; font-size: 14px; }
.pdf-cover-footer { color: #475569; font-size: 13px; margin-top: 20px; }
.pdf-cover-badges { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 16px; }
.pdf-cover-badge {
  background: rgba(59,130,246,0.2); border: 1px solid rgba(59,130,246,0.4);
  color: #93c5fd; padding: 6px 14px; border-radius: 20px; font-size: 12px;
}
.pdf-page { padding: 40px 50px; page-break-inside: avoid; }
.pdf-section-header {
  display: flex; align-items: center; gap: 12px;
  background: linear-gradient(135deg, #1e3a5f, #1e40af);
  color: #fff; padding: 16px 24px; border-radius: 12px;
  margin-bottom: 20px; margin-top: 30px;
}
.pdf-section-icon { font-size: 24px; }
.pdf-section-title { font-size: 18px; font-weight: 700; }
.pdf-qa { margin-bottom: 18px; page-break-inside: avoid; }
.pdf-question { font-weight: 600; color: #334155; font-size: 14px; margin-bottom: 6px; }
.pdf-answer {
  background: #f8fafc; border-right: 4px solid #3b82f6;
  padding: 10px 16px; border-radius: 0 8px 8px 0;
  color: #1e293b; font-size: 14px; line-height: 1.7; white-space: pre-wrap;
}
.pdf-answer.empty { color: #94a3b8; font-style: italic; background: #fafafa; border-right-color: #e2e8f0; }
.pdf-meta-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px; }
.pdf-meta-box { background: #f1f5f9; border-radius: 10px; padding: 16px; }
.pdf-meta-label { color: #64748b; font-size: 12px; margin-bottom: 4px; }
.pdf-meta-value { font-size: 18px; font-weight: 700; color: #1e293b; }
.pdf-unanswered { background: #fef9c3; border: 2px solid #fde047; border-radius: 12px; padding: 20px; margin-top: 20px; }
.pdf-unanswered h3 { color: #854d0e; margin-bottom: 12px; }
.pdf-unanswered-item { color: #92400e; font-size: 13px; margin-bottom: 6px; padding-right: 8px; border-right: 3px solid #fbbf24; padding: 4px 10px; margin-bottom: 6px; }
.pdf-divider { border: none; border-top: 2px solid #e2e8f0; margin: 24px 0; }
.pdf-footer { color: #94a3b8; font-size: 11px; text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid #e2e8f0; }
</style>
</head>
<body>

<!-- â”€â”€â”€ APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="container" id="app">
  <!-- Screens rendered by JS -->
</div>

<!-- â”€â”€â”€ PDF TEMPLATE (hidden, used for generation) â”€â”€â”€ -->
<div id="pdf-template"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CONFIG  â€” ×¢×“×›×Ÿ ××ª ×”×›×ª×•×‘×ª ×©×œ ×”-n8n Webhook ×©×œ×š
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const N8N_WEBHOOK_URL = "https://elishamaf.app.n8n.cloud/webhook/crm-form";
const RECIPIENT_EMAIL = "ELISHAMA1324@GMAIL.COM";

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const KNOWN_INFO = {
  challenges: [
    "× ×™×”×•×œ ×”×–×× ×•×ª ×œ×§×•×—×•×ª ××¨×•×‘×•×ª ×‘××§×‘×™×œ",
    "××¢×§×‘ ×”×¦×¢×•×ª ××—×™×¨ ×œ×¡×¤×§×™× + ×ª×–×›×•×¨×•×ª",
    "×¢×“×›×•×Ÿ ×ª×§×•×¤×ª×™ ×©×œ ×œ×§×•×—×•×ª ×¢×œ ×¡×˜×˜×•×¡ ×”×–×× ×”",
    "× ×™×”×•×œ ×’×¨×¡××•×ª ×©×•× ×•×ª ×©×œ ×”×¦×¢×•×ª ××—×™×¨",
    "××¢×§×‘ ××™×™×œ×™× ×©× ×©×œ×—×• (×”×× ×”×ª×§×‘×œ×• / × ×¢× ×•)",
    "×¢×‘×•×“×” ××•×œ ×¢××™×œ×™ ××›×¡",
    "×§×™×˜×œ×•×’ ××¡××›×™× ×œ×¤×™ ×œ×§×•×— ×•×¤×¨×™×˜",
  ]
};

const STEPS = [
  {
    id: "updates", title: "×¢×“×›×•× ×™× ×•×ª×–×›×•×¨×•×ª", icon: "ğŸ””",
    questions: [
      { id: "customer_update_freq", label: "×›××” ×¤×¢××™× ×‘×©×‘×•×¢/×—×•×“×© ××ª ××¢×“×›× ×ª ×œ×§×•×—×•×ª ×¢×œ ×¡×˜×˜×•×¡ ×”×–×× ×”?", type: "select", options: ["×›×œ ×™×•×","×¤×¢××™×™× ×‘×©×‘×•×¢","×¤×¢× ×‘×©×‘×•×¢","×¤×¢× ×‘×©×‘×•×¢×™×™×","×¨×§ ×›×©×™×© ×¢×“×›×•×Ÿ"] },
      { id: "update_method", label: "××™×š ××ª ×‘×“×¨×š ×›×œ×œ ××¢×“×›× ×ª ×œ×§×•×—×•×ª?", type: "chips", options: ["××™×™×œ","×•×•××˜×¡××¤","×˜×œ×¤×•×Ÿ","×”×œ×§×•×— ×¤×•× ×” ××œ×™×™"] },
      { id: "update_content", label: "××” ×‘×“×¨×š ×›×œ×œ ×›×•×œ×œ ×”×¢×“×›×•×Ÿ ×œ×œ×§×•×—?", type: "chips", options: ["×¡×˜×˜×•×¡ ×”×–×× ×”","×ª××¨×™×š ××¡×¤×§×” ×¦×¤×•×™","××™×§×•× ×”××©×œ×•×—","×¢×™×›×•×‘×™×","××¡××›×™×","××—×¨"] },
      { id: "auto_update", label: "×”×× ×ª×©××—×™ ×©×”××¢×¨×›×ª ×ª×©×œ×— ×¢×“×›×•×Ÿ ××•×˜×•××˜×™ ×œ×œ×§×•×— ×¤×¢× ×‘×©×‘×•×¢?", type: "select", options: ["×›×Ÿ, ×–×” ×™×—×¡×•×š ×œ×™ ×”×¨×‘×” ×–××Ÿ","×›×Ÿ, ××‘×œ ×¨×•×¦×” ×œ××©×¨ ×œ×¤× ×™ ×©×œ×™×—×”","×œ×, ×× ×™ ×¨×•×¦×” ×œ×©×œ×•×— ×‘×¢×¦××™","×ª×œ×•×™ ×‘×œ×§×•×—"] },
      { id: "boss_followup", label: "×”×‘×•×¡ ××‘×§×© ×œ×¤×¢××™× ×œ×¢×§×•×‘ ××—×¨×™ ××™×™×œ×™× ××¡×•×™××™× â€” ××™×š ×–×” ×¢×•×‘×“ ×›×™×•×?", type: "textarea", placeholder: "×œ×“×•×’××”: ×”×•× ×©×•×œ×— ×œ×™ ×”×•×“×¢×” ×©××‘×“×•×§ ×× ×¡×¤×§ X ×¢× ×”..." },
      { id: "missed_followup", label: "×”×× ×§×¨×” ×©×¤×¡×¤×¡×ª ××¢×§×‘ ×¢×œ ××™×™×œ ×—×©×•×‘?", type: "select", options: ["×œ×","×¤×¢× ××—×ª","×›××” ×¤×¢××™×","×§×•×¨×” ×œ×¢×™×ª×™× ×§×¨×•×‘×•×ª"] },
    ]
  },
  {
    id: "quotes", title: "×”×¦×¢×•×ª ××—×™×¨ ×œ×¡×¤×§×™×", icon: "ğŸ’°",
    questions: [
      { id: "quote_open", label: "×›××” ×”×¦×¢×•×ª ××—×™×¨ ×¤×ª×•×—×•×ª (×©×××ª×™× ×•×ª ×œ×ª×©×•×‘×”) ×™×© ×œ×š ×‘×××•×¦×¢ ×‘×›×œ ×¨×’×¢?", type: "select", options: ["1-3","4-10","11-20","×™×•×ª×¨ ×-20"] },
      { id: "quote_wait", label: "×›××” ×–××Ÿ ×‘×××•×¦×¢ ×œ×•×§×— ×œ×¡×¤×§ ×œ×—×–×•×¨ ×¢× ×”×¦×¢×”?", type: "select", options: ["×¢×“ 24 ×©×¢×•×ª","1-3 ×™××™×","×©×‘×•×¢","×™×•×ª×¨ ××©×‘×•×¢","×ª×œ×•×™ ×‘×¡×¤×§"] },
      { id: "quote_track", label: "×›×™×¦×“ ××ª ×¢×•×§×‘×ª ×›×™×•× ××—×¨×™ ×¡×¤×§×™× ×©×œ× ×¢× ×•?", type: "textarea", placeholder: "×œ×“×•×’××”: ×ª×–×›×•×¨×ª ×‘×˜×œ×¤×•×Ÿ, ××¡×× ×ª ×‘××§×¡×œ..." },
      { id: "quote_remind_time", label: "××—×¨×™ ×›××” ×–××Ÿ ×œ×œ× ×ª×©×•×‘×” ××ª ×©×•×œ×—×ª ×ª×–×›×•×¨×ª ×œ×¡×¤×§?", type: "select", options: ["×™×•× ××—×“","2-3 ×™××™×","×©×‘×•×¢","×ª×œ×•×™ ×‘×“×—×™×¤×•×ª"] },
      { id: "quote_auto_remind", label: "×”×× ×ª×©××—×™ ×©×”××¢×¨×›×ª ×ª×ª×¨×™×¢ ×›×©×¡×¤×§ ×œ× ×¢× ×”?", type: "select", options: ["×›×Ÿ, ×‘×”×—×œ×˜!","×›×Ÿ, ××‘×œ ×× ×™ ×©×•×œ×—×ª ×‘×¢×¦××™","×œ× ×¦×¨×™×š"] },
      { id: "quote_multi", label: "×”×× ×œ××•×ª×• ×¤×¨×™×˜ ××ª ×©×•×œ×—×ª ×œ×›××” ×¡×¤×§×™× ×‘××§×‘×™×œ?", type: "select", options: ["×›×Ÿ, ×ª××™×“","×œ×¤×¢××™×","×œ×, ×‘×“×¨×š ×›×œ×œ ×¡×¤×§ ××—×“"] },
      { id: "quote_compare", label: "×›×©×™×© ×›××” ×”×¦×¢×•×ª ×œ××•×ª×• ×¤×¨×™×˜ â€” ××™×š ××ª ××©×•×•×” ×‘×™× ×™×”×Ÿ?", type: "textarea", placeholder: "×œ×“×•×’××”: ××¢×ª×™×§×” ×œ××§×¡×œ ×•××©×•×•×” ×™×“× ×™×ª..." },
    ]
  },
  {
    id: "versions", title: "×’×¨×¡××•×ª ×•×©×™× ×•×™×™×", icon: "ğŸ”€",
    questions: [
      { id: "ver_freq", label: "×›××” ×¤×¢××™× ×”×œ×§×•×— ××©× ×” ×“×¨×™×©×” ××—×¨×™ ×©×›×‘×¨ ×‘×™×§×©×ª ×”×¦×¢×ª ××—×™×¨?", type: "select", options: ["×›××¢×˜ ××£ ×¤×¢×","×œ×¤×¢××™× (20-30%)","×œ×¢×™×ª×™× ×§×¨×•×‘×•×ª","×›××¢×˜ ×ª××™×“"] },
      { id: "ver_what", label: "××” ×‘×“×¨×š ×›×œ×œ ××©×ª× ×”?", type: "chips", options: ["×›××•×ª","××¤×¨×˜ ×˜×›× ×™","×¦×‘×¢ / ×—×•××¨","×ª××¨×™×š ××¡×¤×§×”","×›×ª×•×‘×ª ××©×œ×•×—","××—×™×¨ ××‘×•×§×©","××—×¨"] },
      { id: "ver_manage", label: "×›×™×¦×“ ××ª ×× ×”×œ×ª ×›×™×•× ××ª ×”×’×¨×¡××•×ª ×”×©×•× ×•×ª?", type: "textarea", placeholder: "×œ×“×•×’××”: ×©×•××¨×ª ×›×œ ××™×™×œ, ×›×•×ª×‘×ª ×‘×¦×“ ×‘××§×¡×œ..." },
      { id: "ver_mistake", label: "×”×× ×§×¨×” ×©× ×©×œ×—×” ×”×¦×¢×ª ××—×™×¨ ×œ×¤×™ ×’×¨×¡×” ×™×©× ×” ×‘×˜×¢×•×ª?", type: "select", options: ["×œ×","×¤×¢× ××—×ª","×›××” ×¤×¢××™×","×›×Ÿ, ×–×” ×§×•×¨×”"] },
      { id: "ver_ideal", label: "××” ×”××™×“×™××œ ×©×œ×š ×œ× ×™×”×•×œ ×’×¨×¡××•×ª?", type: "textarea", placeholder: "×œ×“×•×’××”: ×œ×¨××•×ª ××ª ×›×œ ×”×’×¨×¡××•×ª ×©×œ ××•×ª×” ×”×–×× ×” ×‘×˜×•×¨ ××—×“..." },
    ]
  },
  {
    id: "catalog", title: "×§×™×˜×œ×•×’ ×•××¡××›×™×", icon: "ğŸ“",
    questions: [
      { id: "cat_structure", label: "×›×™×•×, ×œ×¤×™ ××” ×××•×¨×’×Ÿ ×”××™×“×¢ ×©×œ×š?", type: "chips", options: ["×œ×¤×™ ×œ×§×•×—","×œ×¤×™ ×¡×¤×§","×œ×¤×™ ×ª××¨×™×š","×œ×¤×™ ×¡×•×’ ××•×¦×¨","×œ×¤×™ ×¡×˜×˜×•×¡","×œ× ×××© ×××•×¨×’×Ÿ"] },
      { id: "cat_files", label: "××™×¤×” ×©××•×¨×™× ×›×™×•× ×”××¡××›×™×?", type: "chips", options: ["Gmail / Outlook","Google Drive","Dropbox","×ª×™×§×™×•×ª ×‘××—×©×‘","××“×¤×¡×ª / × ×™×™×¨","×œ× ×××•×¨×’×Ÿ"] },
      { id: "cat_search", label: "×›××” ×§×œ ×œ××¦×•× ××¡××š ×™×©×Ÿ ×›×©×¦×¨×™×š?", type: "select", options: ["×§×œ ×××•×“, ×™×© ×œ×™ ×¡×“×¨","××¤×©×¨×™ ××‘×œ ×œ×•×§×— ×–××Ÿ","×§×©×”, ×× ×™ ××—×¤×©×ª ×”×¨×‘×”","×œ×¤×¢××™× ×œ× ××•×¦××ª ×‘×›×œ×œ"] },
      { id: "cat_items", label: "×”×× ×™×© ××•×¦×¨×™× ×—×•×–×¨×™×? ×”×× ×™×© ××—×™×¨×•×Ÿ ×§×™×™×?", type: "textarea", placeholder: "×œ×“×•×’××”: ×™×© ×›××” ×¤×¨×™×˜×™× ×©×œ×§×•×—×•×ª ××–××™× ×™× ×ª××™×“..." },
    ]
  },
  {
    id: "process", title: "×ª×”×œ×™×š ×¢×‘×•×“×”", icon: "ğŸ”„",
    questions: [
      { id: "order_flow", label: "×ª××¨×™ ××ª ××¡×¢ ×”×”×–×× ×” ××©×œ×‘ ×”×›× ×™×¡×” ×¢×“ ××¡×™×¨×” ×œ×œ×§×•×—:", type: "textarea", placeholder: "×œ×“×•×’××”:\n1. ×œ×§×•×— ×©×•×œ×— ×‘×§×©×” ×‘××™×™×œ\n2. ×× ×™ ××‘×™× ×” ××” ×”×•× ×¨×•×¦×”\n3. ×©×•×œ×—×ª ×œ×¡×¤×§×™×\n4. ××—×–×™×¨×” ×œ×œ×§×•×—\n5. ×œ××—×¨ ××™×©×•×¨ â€” ××–××™× ×”\n6. ××¢×§×‘ ×©×™×œ×•×—\n7. ×¢××™×œ ××›×¡\n8. ××¡×™×¨×”" },
      { id: "open_orders", label: "×›××” ×”×–×× ×•×ª ×¤×ª×•×—×•×ª ×‘××§×‘×™×œ ×‘×××•×¦×¢?", type: "select", options: ["1-5","6-15","16-30","×™×•×ª×¨ ×-30"] },
      { id: "customs_flow", label: "×ª××¨×™ ××ª ×”×¢×‘×•×“×” ××•×œ ×¢××™×œ×™ ×”××›×¡:", type: "textarea", placeholder: "×œ×“×•×’××”: ×©×•×œ×—×ª ×œ×”× ××¡××›×™ ×©×™×œ×•×—, ×”× ××¢×“×›× ×™× ××•×ª×™..." },
      { id: "biggest_pain", label: "××” ×”×›×™ ××ª×¡×›×œ ××•×ª×š ×›×™×•×?", type: "textarea", placeholder: "×›×ª×‘×™ ×‘×—×•×¤×©×™×•×ª..." },
    ]
  },
  {
    id: "system", title: "×¦×™×¤×™×•×ª ××”××¢×¨×›×ª", icon: "ğŸ¯",
    questions: [
      { id: "must_have", label: "××” ×—×™×™×‘ ×œ×”×™×•×ª ×‘××¢×¨×›×ª ×›×‘×¨ ××”×™×•× ×”×¨××©×•×Ÿ? (Version 1)", type: "textarea", placeholder: "×”×“×‘×¨×™× ×©×‘×œ×¢×“×™×”× ×”××¢×¨×›×ª ×œ× ×©×™××•×©×™×ª..." },
      { id: "nice_to_have", label: "××” ×™×”×™×” × ×—××“ ××‘×œ ××¤×©×¨ ×œ×”×•×¡×™×£ ××—×¨ ×›×š?", type: "textarea", placeholder: "×¤×™×¦'×¨×™× ×œ×¢×ª×™×“..." },
      { id: "sys_users", label: "××™ ×™×©×ª××© ×‘××¢×¨×›×ª?", type: "chips", options: ["×¨×§ ×× ×™","×”×‘×•×¡ ×©×œ×™","×¢×•×“ ×¢×•×‘×“×™×","×”×œ×§×•×—×•×ª ×¢×¦×× (×¤×•×¨×˜×œ ×œ×§×•×—)"] },
      { id: "mobile", label: "×”×× ×—×©×•×‘ ×©×™×¢×‘×•×“ ×‘× ×™×™×“?", type: "select", options: ["×œ×, ×¨×§ ××—×©×‘","× ×—××“ ×œ×• ×™×©","×—×©×•×‘","×§×¨×™×˜×™ â€” ×× ×™ ×‘×¢×™×§×¨ ×¢×œ ×”× ×™×™×“"] },
      { id: "extra", label: "×™×© ×¢×•×“ ××©×”×• ×©×—×©×•×‘ ×œ×š ×©× ×“×¢?", type: "textarea", placeholder: "×›×œ ×“×‘×¨ ×©×œ× ×©××œ× ×•..." },
    ]
  }
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const STORAGE_KEY = 'crm_form_backup';

function saveBackup() {
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify({
      answers: state.answers,
      startTime: state.startTime,
      savedAt: Date.now()
    }));
  } catch(e) {}
}
function loadBackup() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return null;
    const data = JSON.parse(raw);
    // Only restore if saved less than 24 hours ago
    if (Date.now() - data.savedAt < 86400000) return data;
  } catch(e) {}
  return null;
}
function clearBackup() {
  try { localStorage.removeItem(STORAGE_KEY); } catch(e) {}
}

let state = {
  screen: 'intro',
  step: 0,
  answers: {},
  startTime: null,
  endTime: null,
  emailStatus: 'idle',
  hasBackup: false
};

// Check for saved backup on load
const backup = loadBackup();
if (backup && Object.keys(backup.answers).length > 0) {
  state.hasBackup = true;
  state._backupData = backup;
}

function setState(patch) {
  Object.assign(state, patch);
  // Auto-save on every state change if in quiz
  if (state.screen === 'quiz' || state.screen === 'result') saveBackup();
  render();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getVal(id) {
  const v = state.answers[id];
  if (Array.isArray(v)) return v.length ? v.join(", ") : null;
  return v || null;
}
function setAnswer(id, val, skipRender = false) {
  state.answers[id] = val;
  saveBackup(); // auto-backup on every keystroke
  if (!skipRender) render();
}
function toggleChip(id, opt) {
  const cur = Array.isArray(state.answers[id]) ? state.answers[id] : [];
  state.answers[id] = cur.includes(opt) ? cur.filter(x=>x!==opt) : [...cur, opt];
  render();
}
function formatTime(ms) {
  const totalSec = Math.round(ms / 1000);
  const min = Math.floor(totalSec / 60);
  const sec = totalSec % 60;
  return min > 0 ? `${min} ×“×§×•×ª ×•-${sec} ×©× ×™×•×ª` : `${sec} ×©× ×™×•×ª`;
}
function getUnanswered() {
  const result = [];
  STEPS.forEach(s => {
    s.questions.forEach(q => {
      const v = state.answers[q.id];
      const isEmpty = !v || (Array.isArray(v) && v.length === 0) || v === "";
      if (isEmpty) result.push({ step: s.title, icon: s.icon, question: q.label });
    });
  });
  return result;
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SUMMARY GENERATOR â€” ××¡××š ×¡×™×›×•× ×œ×œ×§×•×—
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function nl2br(str) { return (str || '').split('\n').join('<br>'); }
function generateSummaryHtml(forEmail = false) {
  const g = (id) => getVal(id) || 'â€”';
  const date = new Date().toLocaleDateString('he-IL', { year:'numeric', month:'long', day:'numeric' });

  // Build automated recommendations based on answers
  const recs = [];
  
  // Updates automation
  if (g('auto_update').includes('×›×Ÿ')) recs.push({ icon: 'ğŸ””', text: '×¢×“×›×•×Ÿ ××•×˜×•××˜×™ ×©×‘×•×¢×™ ×œ×œ×§×•×—×•×ª', priority: '×—×•×‘×”' });
  if (g('missed_followup') !== '×œ×') recs.push({ icon: 'ğŸ“§', text: '××¢×§×‘ ××™×™×œ×™× + ×ª×–×›×•×¨×•×ª ××•×˜×•××˜×™×•×ª', priority: '×—×•×‘×”' });
  
  // Quotes
  if (g('quote_auto_remind').includes('×›×Ÿ')) recs.push({ icon: 'â°', text: `×ª×–×›×•×¨×ª ××•×˜×•××˜×™×ª ×œ×¡×¤×§ ×œ××—×¨ ${g('quote_remind_time')}`, priority: '×—×•×‘×”' });
  if (g('quote_multi') !== '×œ×, ×‘×“×¨×š ×›×œ×œ ×¡×¤×§ ××—×“') recs.push({ icon: 'ğŸ“Š', text: '×”×©×•×•××ª ×”×¦×¢×•×ª ××—×™×¨ ××¡×¤×§×™× ××¨×•×‘×™×', priority: '×—×©×•×‘' });
  
  // Versions
  if (!g('ver_freq').includes('×›××¢×˜ ××£ ×¤×¢×')) recs.push({ icon: 'ğŸ”€', text: '× ×™×”×•×œ ×’×¨×¡××•×ª ×œ×›×œ ×”×–×× ×” (version control)', priority: '×—×•×‘×”' });
  if (g('ver_mistake') !== '×œ×') recs.push({ icon: 'âš ï¸', text: '×¡×™××•×Ÿ ×’×¨×¡×” ×¤×¢×™×œ×” ×œ×× ×™×¢×ª ×©×’×™××•×ª', priority: '×—×•×‘×”' });
  
  // Catalog
  if (g('cat_search').includes('×§×©×”') || g('cat_search').includes('×œ× ××•×¦××ª')) recs.push({ icon: 'ğŸ”', text: '×× ×•×¢ ×—×™×¤×•×© ××¡××›×™× ××¨×›×–×™', priority: '×—×©×•×‘' });
  
  // Mobile
  if (g('mobile').includes('×—×©×•×‘') || g('mobile').includes('×§×¨×™×˜×™')) recs.push({ icon: 'ğŸ“±', text: '×××©×§ ××•×ª×× ×œ× ×™×™×“', priority: '×—×•×‘×”' });
  
  // Users
  if (g('sys_users').includes('×”×‘×•×¡')) recs.push({ icon: 'ğŸ‘”', text: '×“×©×‘×•×¨×“ ×¡×™×›×•× ×œ×× ×”×œ', priority: '×—×©×•×‘' });
  if (g('sys_users').includes('×¤×•×¨×˜×œ ×œ×§×•×—')) recs.push({ icon: 'ğŸŒ', text: '×¤×•×¨×˜×œ ×œ×§×•×— ×¢×¦×××™', priority: '×¢×ª×™×“×™' });

  const cardStyle = forEmail 
    ? 'background:#f8fafc;border-radius:10px;padding:16px 20px;margin-bottom:12px;border-right:4px solid #3b82f6;'
    : 'background:#f8fafc;border-radius:10px;padding:16px 20px;margin-bottom:12px;border-right:4px solid #3b82f6;';

  const recBadge = (p) => {
    const colors = { '×—×•×‘×”': '#dc2626', '×—×©×•×‘': '#d97706', '×¢×ª×™×“×™': '#6b7280' };
    const bg = { '×—×•×‘×”': '#fef2f2', '×—×©×•×‘': '#fffbeb', '×¢×ª×™×“×™': '#f9fafb' };
    return `<span style="background:${bg[p]};color:${colors[p]};border:1px solid ${colors[p]};padding:2px 10px;border-radius:20px;font-size:11px;font-weight:700;">${p}</span>`;
  };

  return `
  <div style="direction:rtl;font-family:'Segoe UI',Tahoma,sans-serif;background:#fff;">
    
    <!-- SUMMARY HEADER -->
    <div style="background:linear-gradient(135deg,#1e3a5f,#1e40af);padding:40px 50px;color:#fff;">
      <div style="font-size:13px;letter-spacing:2px;color:#93c5fd;margin-bottom:8px;">×¡×™×›×•× ××¤×™×•×Ÿ</div>
      <div style="font-size:28px;font-weight:800;margin-bottom:6px;">××” ×”××¢×¨×›×ª ×©×œ×š ×¦×¨×™×›×” ×œ×›×œ×•×œ</div>
      <div style="color:#bfdbfe;font-size:14px;">${date} | × ×•×¦×¨ ×¢×œ ×‘×¡×™×¡ ×”×©××œ×•×Ÿ ×©××™×œ××ª</div>
    </div>

    <div style="padding:40px 50px;">

      <!-- PAIN POINTS -->
      <div style="margin-bottom:36px;">
        <div style="font-size:18px;font-weight:800;color:#1e293b;margin-bottom:6px;padding-bottom:10px;border-bottom:3px solid #e2e8f0;">
          ğŸ˜¤ ×”×›××‘×™× ×”×¢×™×§×¨×™×™× ×©×¢×œ×•
        </div>
        <div style="margin-top:16px;">
          ${g('biggest_pain') !== 'â€”' ? '<div style="' + cardStyle + '">' + nl2br(g('biggest_pain')) + '</div>' : ''}
          ${g('missed_followup') !== '×œ×' && g('missed_followup') !== 'â€”' ? '<div style="' + cardStyle + '">×¤×¡×¤×•×¡ ××¢×§×‘ ×¢×œ ××™×™×œ×™×: <strong>' + g('missed_followup') + '</strong></div>' : ''}
          ${g('cat_search').includes('×§×©×”') || g('cat_search').includes('×œ× ××•×¦××ª') ? '<div style="' + cardStyle + '">×§×•×©×™ ×‘××¦×™××ª ××¡××›×™×: <strong>' + g('cat_search') + '</strong></div>' : ''}
          ${g('ver_mistake') !== '×œ×' && g('ver_mistake') !== 'â€”' ? '<div style="' + cardStyle + '">×©×’×™××•×ª ×’×¨×¡××•×ª: <strong>' + g('ver_mistake') + '</strong></div>' : ''}
        </div>
      </div>

      <!-- CURRENT PROCESS -->
      <div style="margin-bottom:36px;">
        <div style="font-size:18px;font-weight:800;color:#1e293b;margin-bottom:6px;padding-bottom:10px;border-bottom:3px solid #e2e8f0;">
          ğŸ”„ ×ª×”×œ×™×š ×”×¢×‘×•×“×” ×”× ×•×›×—×™
        </div>
        <div style="margin-top:16px;">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;">
            <div style="background:#f1f5f9;border-radius:10px;padding:16px;">
              <div style="color:#64748b;font-size:11px;margin-bottom:4px;">×”×–×× ×•×ª ×¤×ª×•×—×•×ª ×‘××§×‘×™×œ</div>
              <div style="font-size:20px;font-weight:800;color:#1e3a5f;">${g('open_orders')}</div>
            </div>
            <div style="background:#f1f5f9;border-radius:10px;padding:16px;">
              <div style="color:#64748b;font-size:11px;margin-bottom:4px;">×”×¦×¢×•×ª ××—×™×¨ ×¤×ª×•×—×•×ª</div>
              <div style="font-size:20px;font-weight:800;color:#1e3a5f;">${g('quote_open')}</div>
            </div>
            <div style="background:#f1f5f9;border-radius:10px;padding:16px;">
              <div style="color:#64748b;font-size:11px;margin-bottom:4px;">×ª×“×™×¨×•×ª ×¢×“×›×•×Ÿ ×œ×§×•×—×•×ª</div>
              <div style="font-size:16px;font-weight:700;color:#1e3a5f;">${g('customer_update_freq')}</div>
            </div>
            <div style="background:#f1f5f9;border-radius:10px;padding:16px;">
              <div style="color:#64748b;font-size:11px;margin-bottom:4px;">×©×™× ×•×™×™ ×’×¨×¡××•×ª</div>
              <div style="font-size:16px;font-weight:700;color:#1e3a5f;">${g('ver_freq')}</div>
            </div>
          </div>
          ${g('order_flow') !== 'â€”' ? `
          <div style="margin-top:14px;">
            <div style="font-weight:600;color:#334155;font-size:14px;margin-bottom:8px;">××¡×¢ ×”×–×× ×”:</div>
            <div style="background:#f8fafc;border-right:4px solid #3b82f6;padding:12px 16px;border-radius:0 8px 8px 0;font-size:13px;line-height:1.8;white-space:pre-wrap;">${g('order_flow')}</div>
          </div>` : ''}
        </div>
      </div>

      <!-- VERSION 1 REQUIREMENTS -->
      <div style="margin-bottom:36px;">
        <div style="font-size:18px;font-weight:800;color:#1e293b;margin-bottom:6px;padding-bottom:10px;border-bottom:3px solid #e2e8f0;">
          âœ… ××” ×—×™×™×‘ ×œ×”×™×•×ª â€” Version 1
        </div>
        <div style="margin-top:16px;">
          ${g('must_have') !== 'â€”' ? '<div style="' + cardStyle + '">' + nl2br(g('must_have')) + '</div>' : '<div style="color:#94a3b8;font-style:italic;">×œ× ×¦×•×™×Ÿ</div>'}
        </div>
      </div>

      <!-- FUTURE -->
      ${g('nice_to_have') !== 'â€”' ? `
      <div style="margin-bottom:36px;">
        <div style="font-size:18px;font-weight:800;color:#1e293b;margin-bottom:6px;padding-bottom:10px;border-bottom:3px solid #e2e8f0;">
          ğŸ”® Version 2 â€” ×œ×¢×ª×™×“
        </div>
        <div style="margin-top:16px;">
          <div style="background:#f0fdf4;border-right:4px solid #10b981;padding:12px 16px;border-radius:0 8px 8px 0;font-size:13px;line-height:1.8;">${nl2br(g('nice_to_have'))}</div>
        </div>
      </div>` : ''}

      <!-- RECOMMENDATIONS -->
      <div style="margin-bottom:36px;">
        <div style="font-size:18px;font-weight:800;color:#1e293b;margin-bottom:6px;padding-bottom:10px;border-bottom:3px solid #e2e8f0;">
          ğŸ› ï¸ ×”××œ×¦×•×ª ×œ××¢×¨×›×ª â€” ×¢×œ ×‘×¡×™×¡ ×”×ª×©×•×‘×•×ª ×©×œ×š
        </div>
        <div style="margin-top:16px;">
          <!-- Always recommended -->
          ${['× ×™×”×•×œ ×”×–×× ×•×ª ×¢× ×¡×˜×˜×•×¡×™× ××•×ª×××™× ××™×©×™×ª','×›×¨×˜×™×¡ ×œ×§×•×— + ×”×™×¡×˜×•×¨×™×™×ª ×”×–×× ×•×ª','×›×¨×˜×™×¡ ×¡×¤×§ + ×‘×™×¦×•×¢×™×','××¢×§×‘ ××¡××›×™× ×œ×›×œ ×”×–×× ×”','×“×©×‘×•×¨×“ â€” ×›×œ ×”×”×–×× ×•×ª ×”×¤×ª×•×—×•×ª ×‘××‘×˜ ××—×“'].map(t=>`
            <div style="display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-radius:10px;background:#f8fafc;margin-bottom:8px;">
              <span style="font-size:14px;color:#1e293b;">ğŸ“‹ ${t}</span>
              ${recBadge('×—×•×‘×”')}
            </div>
          `).join('')}
          <!-- Dynamic recommendations -->
          ${recs.map(r=>`
            <div style="display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-radius:10px;background:#f8fafc;margin-bottom:8px;">
              <span style="font-size:14px;color:#1e293b;">${r.icon} ${r.text}</span>
              ${recBadge(r.priority)}
            </div>
          `).join('')}
        </div>
      </div>

      <!-- USERS & MOBILE -->
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:24px;">
        <div style="background:#f1f5f9;border-radius:12px;padding:20px;">
          <div style="color:#64748b;font-size:12px;margin-bottom:8px;">ğŸ‘¥ ××©×ª××©×™×</div>
          <div style="font-size:14px;font-weight:600;color:#1e293b;">${g('sys_users')}</div>
        </div>
        <div style="background:#f1f5f9;border-radius:12px;padding:20px;">
          <div style="color:#64748b;font-size:12px;margin-bottom:8px;">ğŸ“± × ×™×™×“</div>
          <div style="font-size:14px;font-weight:600;color:#1e293b;">${g('mobile')}</div>
        </div>
      </div>

      <div style="color:#94a3b8;font-size:11px;text-align:center;margin-top:32px;padding-top:16px;border-top:1px solid #e2e8f0;">
        ××¡××š ×–×” ×”×•×¤×§ ××•×˜×•××˜×™×ª ×¢×œ ×‘×¡×™×¡ ×”×©××œ×•×Ÿ ×©××™×œ××ª | ${date}
      </div>
    </div>
  </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PDF GENERATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildPdfHtml() {
  const unanswered = getUnanswered();
  const timeTaken = state.endTime && state.startTime ? formatTime(state.endTime - state.startTime) : "×œ× × ××“×“";
  const date = new Date().toLocaleDateString('he-IL', { year:'numeric', month:'long', day:'numeric' });
  const businessName = getVal('business_name') || getVal('cat_structure') || "×œ×§×•×— CRM";

  let sectionsHtml = '';
  STEPS.forEach(step => {
    sectionsHtml += `
      <div class="pdf-section-header" style="display:flex;align-items:center;gap:12px;background:linear-gradient(135deg,#1e3a5f,#1e40af);color:#fff;padding:16px 24px;border-radius:12px;margin-bottom:20px;margin-top:30px;page-break-before:auto;">
        <span style="font-size:22px;">${step.icon}</span>
        <span style="font-size:17px;font-weight:700;">${step.title}</span>
      </div>
    `;
    step.questions.forEach(q => {
      const val = getVal(q.id);
      const isEmpty = !val;
      sectionsHtml += `
        <div style="margin-bottom:18px;page-break-inside:avoid;">
          <div style="font-weight:600;color:#334155;font-size:13px;margin-bottom:6px;">${q.label}</div>
          <div style="background:${isEmpty?'#fafafa':'#f8fafc'};border-right:4px solid ${isEmpty?'#e2e8f0':'#3b82f6'};padding:10px 16px;border-radius:0 8px 8px 0;color:${isEmpty?'#94a3b8':'#1e293b'};font-size:13px;line-height:1.7;${isEmpty?'font-style:italic;':''}white-space:pre-wrap;">
            ${isEmpty ? 'â€” ×œ× ××•×œ× â€”' : val.replace(/</g,'&lt;')}
          </div>
        </div>
      `;
    });
  });

  const unansweredHtml = unanswered.length > 0 ? `
    <div style="background:#fef9c3;border:2px solid #fde047;border-radius:12px;padding:20px;margin-top:30px;page-break-inside:avoid;">
      <h3 style="color:#854d0e;margin-bottom:14px;font-size:16px;">âš ï¸ ×©××œ×•×ª ×©×œ× ××•×œ××• (${unanswered.length})</h3>
      ${unanswered.map(u => `
        <div style="background:#fff;border-right:3px solid #fbbf24;padding:8px 12px;margin-bottom:8px;border-radius:0 6px 6px 0;font-size:13px;color:#92400e;">
          <span style="font-weight:600;">${u.icon} ${u.step}:</span> ${u.question}
        </div>
      `).join('')}
    </div>
  ` : `<div style="background:#dcfce7;border:2px solid #86efac;border-radius:12px;padding:16px 20px;margin-top:30px;color:#166534;font-weight:600;">âœ… ×›×œ ×”×©××œ×•×ª ××•×œ××• â€” ×ª×©×•×‘×•×ª ××œ××•×ª!</div>`;

  return `
  <div style="direction:rtl;font-family:'Segoe UI',Tahoma,sans-serif;background:#fff;width:100%;">
    
    <!-- COVER PAGE -->
    <div style="background:linear-gradient(135deg,#0f172a,#1e3a5f);padding:60px 50px;min-height:270mm;display:flex;flex-direction:column;justify-content:space-between;page-break-after:always;">
      <div>
        <div style="font-size:60px;margin-bottom:24px;">ğŸ—‚ï¸</div>
        <div style="color:#fff;font-size:34px;font-weight:800;margin-bottom:8px;">××¡××š ××¤×™×•×Ÿ</div>
        <div style="color:#93c5fd;font-size:20px;margin-bottom:48px;">××¢×¨×›×ª CRM ×œ× ×™×”×•×œ ×¨×›×© ×•×™×‘×•×</div>
        
        <div style="background:rgba(255,255,255,0.08);border-radius:16px;padding:28px;border:1px solid rgba(255,255,255,0.15);">
          <div style="color:#60a5fa;font-size:12px;letter-spacing:2px;margin-bottom:16px;">×¤×¨×˜×™ ×œ×§×•×—</div>
          <div style="color:#94a3b8;font-size:13px;margin-bottom:4px;">×¢×¡×§</div>
          <div style="color:#fff;font-size:18px;font-weight:600;margin-bottom:16px;">${businessName}</div>
          <div style="color:#94a3b8;font-size:13px;margin-bottom:4px;">×ª××¨×™×š</div>
          <div style="color:#fff;font-size:16px;">${date}</div>
        </div>
      </div>
      
      <div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:20px;">
          ${STEPS.map(s=>`<span style="background:rgba(59,130,246,0.2);border:1px solid rgba(59,130,246,0.4);color:#93c5fd;padding:5px 12px;border-radius:20px;font-size:11px;">${s.icon} ${s.title}</span>`).join('')}
        </div>
        <div style="color:#475569;font-size:12px;">×”×•×¤×§ ×¢"×™ ××¢×¨×›×ª ××¤×™×•×Ÿ CRM ××•×˜×•××˜×™×ª | ${RECIPIENT_EMAIL}</div>
      </div>
    </div>

    <!-- STATS PAGE -->
    <div style="padding:40px 50px;page-break-after:always;">
      <div style="font-size:22px;font-weight:800;color:#1e293b;margin-bottom:24px;padding-bottom:12px;border-bottom:3px solid #e2e8f0;">ğŸ“Š ×¡×™×›×•× ×˜×›× ×™</div>
      
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:28px;">
        <div style="background:#f1f5f9;border-radius:12px;padding:20px;text-align:center;">
          <div style="color:#64748b;font-size:12px;margin-bottom:8px;">×–××Ÿ ××™×œ×•×™ ×”×©××œ×•×Ÿ</div>
          <div style="font-size:22px;font-weight:800;color:#1e3a5f;">${timeTaken}</div>
        </div>
        <div style="background:${unanswered.length>0?'#fef9c3':'#dcfce7'};border-radius:12px;padding:20px;text-align:center;">
          <div style="color:#64748b;font-size:12px;margin-bottom:8px;">×©××œ×•×ª ×œ× ××•×œ××•</div>
          <div style="font-size:22px;font-weight:800;color:${unanswered.length>0?'#854d0e':'#166534'};">${unanswered.length}</div>
        </div>
        <div style="background:#f1f5f9;border-radius:12px;padding:20px;text-align:center;">
          <div style="color:#64748b;font-size:12px;margin-bottom:8px;">×©××œ×•×ª ×©××•×œ××•</div>
          <div style="font-size:22px;font-weight:800;color:#1e293b;">${STEPS.reduce((a,s)=>a+s.questions.length,0) - unanswered.length} / ${STEPS.reduce((a,s)=>a+s.questions.length,0)}</div>
        </div>
        <div style="background:#f1f5f9;border-radius:12px;padding:20px;text-align:center;">
          <div style="color:#64748b;font-size:12px;margin-bottom:8px;">×ª××¨×™×š ××™×œ×•×™</div>
          <div style="font-size:16px;font-weight:700;color:#1e293b;">${date}</div>
        </div>
      </div>

      <div style="background:#f8fafc;border-radius:12px;padding:24px;margin-bottom:24px;">
        <div style="font-weight:700;color:#1e293b;margin-bottom:14px;font-size:15px;">ğŸ” ××ª×’×¨×™× ×©×¢×œ×• ×‘×©×™×—×ª ×”×”×™×›×¨×•×ª:</div>
        ${KNOWN_INFO.challenges.map(c=>`
          <div style="display:flex;gap:10px;align-items:flex-start;margin-bottom:8px;font-size:13px;color:#374151;">
            <span style="color:#3b82f6;margin-top:2px;">â€¢</span><span>${c}</span>
          </div>
        `).join('')}
      </div>

      ${unansweredHtml}
    </div>

    <!-- SUMMARY PAGE (what client sees) -->
    <div style="page-break-before:always;">
      ${generateSummaryHtml()}
    </div>

    <!-- ANSWERS PAGES (full Q&A) -->
    <div style="padding:40px 50px;page-break-before:always;">
      <div style="font-size:22px;font-weight:800;color:#1e293b;margin-bottom:8px;padding-bottom:12px;border-bottom:3px solid #e2e8f0;">ğŸ“‹ ×ª×©×•×‘×•×ª ××¤×•×¨×˜×•×ª</div>
      ${sectionsHtml}
      <div style="color:#94a3b8;font-size:11px;text-align:center;margin-top:40px;padding-top:20px;border-top:1px solid #e2e8f0;">
        ××¡××š ×–×” ×”×•×¤×§ ××•×˜×•××˜×™×ª ×¢"×™ ××¢×¨×›×ª ××¤×™×•×Ÿ CRM | ${date}
      </div>
    </div>
  </div>`;
}

async function generateAndDownloadPDF() {
  const pdfContainer = document.getElementById('pdf-template');
  pdfContainer.innerHTML = buildPdfHtml();
  pdfContainer.style.display = 'block';

  const opt = {
    margin: 0,
    filename: `××¤×™×•×Ÿ-CRM-${new Date().toLocaleDateString('he-IL').replace(/\//g,'-')}.pdf`,
    image: { type: 'jpeg', quality: 0.97 },
    html2canvas: { scale: 2, useCORS: true, letterRendering: true, allowTaint: true },
    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
  };

  await html2pdf().set(opt).from(pdfContainer).save();
  pdfContainer.style.display = 'none';
  return true;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  EMAIL VIA N8N WEBHOOK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function sendToN8n() {
  setState({ emailStatus: 'sending' });
  const unanswered = getUnanswered();
  const timeTaken = state.endTime && state.startTime ? formatTime(state.endTime - state.startTime) : "×œ× × ××“×“";

  const allAnswers = {};
  STEPS.forEach(step => {
    step.questions.forEach(q => {
      const v = state.answers[q.id];
      allAnswers[q.id] = {
        question: q.label,
        section: step.title,
        answer: Array.isArray(v) ? v.join(', ') : (v || '')
      };
    });
  });

  // Build full Q&A text for email
  let qaText = '';
  STEPS.forEach(step => {
    qaText += '\n\n--- ' + step.icon + ' ' + step.title + ' ---\n';
    step.questions.forEach(q => {
      const v = state.answers[q.id];
      const ans = Array.isArray(v) ? v.join(', ') : (v || '×œ× ××•×œ×');
      qaText += '\n×©××œ×”: ' + q.label + '\n×ª×©×•×‘×”: ' + ans + '\n';
    });
  });

  const payload = {
    recipient: RECIPIENT_EMAIL,
    date: new Date().toLocaleDateString('he-IL'),
    timestamp: new Date().toISOString(),
    timeTaken,
    totalQuestions: STEPS.reduce((a,s)=>a+s.questions.length,0),
    unansweredCount: unanswered.length,
    unanswered: unanswered.map(u=>`${u.icon} ${u.step}: ${u.question}`),
    answers: allAnswers,
    qaText,
    summaryHtml: generateSummaryHtml(true),
    businessName: getVal('cat_structure') || '×œ× ×¦×•×™×Ÿ',
    mustHave: getVal('must_have') || '×œ× ×¦×•×™×Ÿ',
    biggestPain: getVal('biggest_pain') || '×œ× ×¦×•×™×Ÿ'
  };

  try {
    const res = await fetch(N8N_WEBHOOK_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    if (!res.ok) throw new Error(`Status ${res.status}`);
    setState({ emailStatus: 'success' });
  } catch (err) {
    console.error('Webhook error:', err);
    setState({ emailStatus: 'error' });
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function render() {
  const app = document.getElementById('app');
  if (state.screen === 'intro') app.innerHTML = renderIntro();
  else if (state.screen === 'quiz') app.innerHTML = renderQuiz();
  else app.innerHTML = renderResult();
  attachEvents();
}

// â”€â”€â”€ INTRO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderIntro() {
  return `
  <div style="text-align:center;margin-bottom:32px;padding-top:10px;">
    <div style="font-size:56px;margin-bottom:12px;">ğŸ—‚ï¸</div>
    <h1 style="color:#fff;font-size:30px;font-weight:800;">××¤×™×•×Ÿ ××¢×¨×›×ª CRM</h1>
    <p class="subtitle">× ×™×”×•×œ ×¨×›×© ×•×™×‘×•× ×‘×™× ×œ××•××™</p>
  </div>

  <div class="glass">
    <h3 style="color:#60a5fa;margin-bottom:16px;">ğŸ’¡ ××” ×©×”×‘× ×• ×¢×“ ×¢×›×©×™×• ××”×©×™×—×”</h3>
    <div class="info-row"><span class="info-label">×¢×¡×§:</span> ×—×‘×¨×” ×”×¢×•×¡×§×ª ×‘×™×™×‘×•× ×•×¨×›×© ×‘×™× ×œ××•××™</div>
    <div class="info-row"><span class="info-label">×ª×¤×§×™×“:</span> ×× ×”×œ×ª ×¨×›×©</div>
    <div class="info-row"><span class="info-label">×›×œ×™× ×§×™×™××™×:</span> ××™×™×œ×™×, ××§×¡×œ ×œ×œ×§×•×—×•×ª, ×•×•××˜×¡××¤</div>
    <div style="margin-top:14px;">
      <div class="info-label" style="margin-bottom:10px;">××ª×’×¨×™× ×©×¢×œ×• ×‘×©×™×—×”:</div>
      ${KNOWN_INFO.challenges.map(c=>`
        <div class="challenge-item">
          <span class="challenge-dot">â€¢</span>
          <span style="color:#cbd5e1;font-size:14px;">${c}</span>
        </div>
      `).join('')}
    </div>
  </div>

  <div class="glass">
    <h3 style="color:#34d399;margin-bottom:16px;">ğŸ“‹ ×¢×œ ×”×©××œ×•×Ÿ</h3>
    <p style="color:#cbd5e1;line-height:1.8;font-size:14px;margin-bottom:16px;">
      ×”×©××œ×•×Ÿ ×™×¢×–×•×¨ ×œ× ×• ×œ×‘× ×•×ª ×¢×‘×•×¨×š ××¢×¨×›×ª ××•×ª×××ª ×‘×“×™×•×§ ×œ×¦×¨×›×™× ×©×œ×š.
      <strong style="color:#fff;">××™×Ÿ ×ª×©×•×‘×•×ª × ×›×•× ×•×ª ××• ×œ× × ×›×•× ×•×ª</strong> â€”
      ×›×›×œ ×©×ª×”×™×™ ×¤×ª×•×—×” ×•××¤×•×¨×˜×ª, ×›×š ×”××¢×¨×›×ª ×ª×”×™×” ×˜×•×‘×” ×™×•×ª×¨.
    </p>
    <div style="display:flex;flex-direction:column;gap:10px;">
      ${[["â±ï¸","×œ×•×§×— ×›-10-15 ×“×§×•×ª ×œ××œ×"],["ğŸ“„","×‘×¡×•×£ ×ª×•×›×œ×™ ×œ×”×•×¨×™×“ ×§×•×‘×¥ PDF ××¡×•×“×¨"],["ğŸ“§","×”××¡××š ×™×©×œ×— ××•×˜×•××˜×™×ª ×œ××œ×™×™×©××¢"],["ğŸ”„","6 × ×•×©××™× â€” ×¢×•×‘×¨×™× ×©×œ×‘ ×©×œ×‘"]].map(([i,t])=>`
        <div style="display:flex;align-items:center;gap:12px;color:#94a3b8;font-size:14px;">
          <span style="font-size:18px;">${i}</span><span>${t}</span>
        </div>
      `).join('')}
    </div>
  </div>

  <div class="glass" style="margin-bottom:28px;">
    <h3 style="color:#94a3b8;font-size:13px;letter-spacing:1px;margin-bottom:14px;">×”× ×•×©××™× ×©× ×¢×‘×•×¨:</h3>
    <div>${STEPS.map(s=>`<span class="topic-badge">${s.icon} ${s.title}</span>`).join('')}</div>
  </div>

  ${state.hasBackup ? `
  <div style="background:rgba(59,130,246,0.15);border:1px solid rgba(59,130,246,0.4);border-radius:14px;padding:20px;margin-bottom:20px;text-align:center;">
    <div style="color:#93c5fd;font-weight:700;font-size:15px;margin-bottom:8px;">ğŸ’¾ × ××¦× ×©××œ×•×Ÿ ×©××•×¨ ××•×§×“× ×™×•×ª×¨</div>
    <div style="color:#94a3b8;font-size:13px;margin-bottom:16px;">×”×× ×ª×¨×¦×™ ×œ×”××©×™×š ×××™×¤×” ×©×”×¤×¡×§×ª?</div>
    <div style="display:flex;justify-content:center;gap:12px;">
      <button class="btn btn-primary" onclick="restoreBackup()" style="background:#3b82f6;">âœ… ×›×Ÿ, ×”××©×™×›×™</button>
      <button class="btn btn-outline" style="background:transparent;color:#94a3b8;border-color:#475569;" onclick="discardBackup()">âŒ ×”×ª×—×™×œ×™ ××—×“×©</button>
    </div>
  </div>` : ''}
  <div style="text-align:center;">
    <button class="btn btn-primary btn-large" onclick="startQuiz()" 
      style="background:linear-gradient(135deg,#1e40af,#3b82f6);box-shadow:0 8px 30px rgba(59,130,246,0.4);">
      ğŸš€ ×‘×•××™ × ×ª×—×™×œ!
    </button>
    <p style="color:#475569;font-size:13px;margin-top:12px;">×œ×—×¦×™ ×›×©××ª ××•×›× ×”</p>
  </div>`;
}

// â”€â”€â”€ QUIZ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderQuiz() {
  const step = STEPS[state.step];
  const pct = (state.step / STEPS.length) * 100;

  const qs = step.questions.map(q => {
    const val = state.answers[q.id];
    let field = '';
    if (q.type === 'text') {
      field = `<input type="text" value="${(val||'').replace(/"/g,'&quot;')}" placeholder="${q.placeholder||''}" oninput="setAnswer('${q.id}',this.value,true)">`;
    } else if (q.type === 'textarea') {
      field = `<textarea rows="4" placeholder="${q.placeholder||''}" oninput="setAnswer('${q.id}',this.value,true)">${val||''}</textarea>`;
    } else if (q.type === 'select') {
      field = `<select onchange="setAnswer('${q.id}',this.value)">
        <option value="">-- ×‘×—×¨/×™ --</option>
        ${q.options.map(o=>`<option value="${o}" ${val===o?'selected':''}>${o}</option>`).join('')}
      </select>`;
    } else if (q.type === 'chips') {
      const sel = Array.isArray(val) ? val : [];
      field = `<div class="chips">${q.options.map(o=>`
        <button class="chip ${sel.includes(o)?'active':''}" onclick="toggleChip('${q.id}','${o}')">${sel.includes(o)?'âœ“ ':''}${o}</button>
      `).join('')}</div>`;
    }
    return `<div><label class="label">${q.label}</label>${field}</div>`;
  }).join('');

  const pills = STEPS.map((s,i)=>`
    <div class="pill ${i<state.step?'done':i===state.step?'active':'todo'}" 
      ${i<state.step?`onclick="goStep(${i})"`:''}>${i<state.step?'âœ“':s.icon} ${s.title}</div>
  `).join('');

  return `
  <div class="progress-bar-bg"><div class="progress-bar" style="width:${pct}%"></div></div>
  <div class="step-pills">${pills}</div>
  <div style="display:flex;justify-content:space-between;margin-bottom:16px;">
    <span style="color:#94a3b8;font-size:13px;">×©×œ×‘ ${state.step+1} ××ª×•×š ${STEPS.length}</span>
    <span style="color:#60a5fa;font-size:13px;cursor:pointer;" onclick="setState({screen:'intro'})">â† ×—×–×¨×” ×œ×¤×ª×™×—×”</span>
  </div>
  <div class="card">
    <div class="card-header"><h2>${step.icon} ${step.title}</h2></div>
    <div class="card-body">
      <div class="q-group">${qs}</div>
      <div class="nav">
        <button class="btn btn-outline" onclick="${state.step>0?`goStep(${state.step-1})`:"setState({screen:'intro'})"}">â†’ ×”×§×•×“×</button>
        ${state.step < STEPS.length-1
          ? `<button class="btn btn-primary" onclick="goStep(${state.step+1})">×”×‘× â†</button>`
          : `<button class="btn btn-success" onclick="finishQuiz()">ğŸ‰ ×™×¦×™×¨×ª ××¡××š ××¤×™×•×Ÿ</button>`
        }
      </div>
    </div>
  </div>`;
}

// â”€â”€â”€ RESULT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderResult() {
  const unanswered = getUnanswered();
  const timeTaken = state.endTime && state.startTime ? formatTime(state.endTime - state.startTime) : "â€”";
  const totalQ = STEPS.reduce((a,s)=>a+s.questions.length,0);

  let emailStatusHtml = '';
  if (state.emailStatus === 'sending') {
    emailStatusHtml = `<div class="status-box status-sending"><div class="spinner"></div> ×©×•×œ×— ××ª ×”× ×ª×•× ×™× ×œ××œ×™×™×©××¢...</div>`;
  } else if (state.emailStatus === 'success') {
    emailStatusHtml = `<div class="status-box status-success">âœ… ×”× ×ª×•× ×™× × ×©×œ×—×• ×‘×”×¦×œ×—×” ×œ××œ×™×™×©××¢!</div>`;
  } else if (state.emailStatus === 'error') {
    emailStatusHtml = `<div class="status-box status-error">
      âš ï¸ ×œ× ×”×¦×œ×—× ×• ×œ×©×œ×•×— ××•×˜×•××˜×™×ª â€” PDF ×”×•×¨×“ ×œ××—×©×‘ ×©×œ×š.
      <br><small style="margin-top:6px;display:block;">×•×“× ×©×”-Webhook ×‘-n8n ××•×’×“×¨ × ×›×•×Ÿ.</small>
    </div>`;
  }

  const unansweredHtml = unanswered.length > 0 ? `
    <div style="background:#fef9c3;border:1px solid #fde047;border-radius:12px;padding:16px;margin-top:16px;">
      <div style="font-weight:600;color:#854d0e;margin-bottom:10px;">âš ï¸ ×©××œ×•×ª ×©×œ× ××•×œ××• (${unanswered.length}):</div>
      ${unanswered.map(u=>`<div style="color:#92400e;font-size:13px;border-right:3px solid #fbbf24;padding:4px 10px;margin-bottom:6px;">${u.icon} <strong>${u.step}:</strong> ${u.question}</div>`).join('')}
    </div>` : `<div style="background:#dcfce7;border:1px solid #86efac;border-radius:10px;padding:12px 16px;color:#166534;font-weight:600;margin-top:12px;">âœ… ×›×œ ×”×©××œ×•×ª ××•×œ××•!</div>`;

  return `
  <div class="card">
    <div class="result-header">
      <div style="font-size:48px;margin-bottom:10px;">ğŸ‰</div>
      <h2>××¡××š ×”××¤×™×•×Ÿ ××•×›×Ÿ!</h2>
      <p>×ª×•×“×”! ×”× ×” ×”×¤×¢×•×œ×•×ª ×”×‘××•×ª:</p>
    </div>
    <div class="card-body">
      ${emailStatusHtml}
      
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:20px;">
        <div style="background:#f1f5f9;border-radius:12px;padding:16px;text-align:center;">
          <div style="color:#64748b;font-size:12px;margin-bottom:4px;">×–××Ÿ ××™×œ×•×™</div>
          <div style="font-size:20px;font-weight:800;color:#1e3a5f;">${timeTaken}</div>
        </div>
        <div style="background:${unanswered.length>0?'#fef9c3':'#dcfce7'};border-radius:12px;padding:16px;text-align:center;">
          <div style="color:#64748b;font-size:12px;margin-bottom:4px;">×©××œ×•×ª ×œ× ××•×œ××•</div>
          <div style="font-size:20px;font-weight:800;color:${unanswered.length>0?'#854d0e':'#166534'};">${unanswered.length} / ${totalQ}</div>
        </div>
      </div>

      ${unansweredHtml}

      <div class="action-btns" style="margin-top:24px;">
        <button class="btn btn-primary" onclick="downloadPDF()" id="pdf-btn">
          ğŸ“¥ ×”×•×¨×“ PDF
        </button>
        <button class="btn btn-outline" onclick="clearBackup();setState({screen:'intro',step:0,answers:{},startTime:null,endTime:null,emailStatus:'idle',hasBackup:false})">
          ğŸ”„ ××œ××™ ××—×“×©
        </button>
      </div>
    </div>
  </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  EVENTS & ACTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function attachEvents() {}

function startQuiz() {
  state.startTime = Date.now();
  setState({ screen: 'quiz', step: 0 });
}
function restoreBackup() {
  const data = state._backupData;
  if (data) {
    state.answers = data.answers;
    state.startTime = data.startTime;
    state.hasBackup = false;
    setState({ screen: 'quiz', step: 0 });
  }
}
function discardBackup() {
  clearBackup();
  state.hasBackup = false;
  state._backupData = null;
  render();
}
function goStep(i) { setState({ step: i }); }
function finishQuiz() {
  state.endTime = Date.now();
  setState({ screen: 'result' });
  // Auto-send to n8n if URL is configured
  if (N8N_WEBHOOK_URL && !N8N_WEBHOOK_URL.includes('YOUR-N8N')) {
    sendToN8n();
  }
}
async function downloadPDF() {
  const btn = document.getElementById('pdf-btn');
  if (btn) { btn.disabled = true; btn.textContent = 'â³ ××™×™×¦×¨ PDF...'; }
  await generateAndDownloadPDF();
  if (btn) { btn.disabled = false; btn.textContent = 'âœ… PDF ×”×•×¨×“!'; }
}

// Expose to global scope for inline event handlers
window.startQuiz = startQuiz;
window.restoreBackup = restoreBackup;
window.discardBackup = discardBackup;
window.goStep = goStep;
window.finishQuiz = finishQuiz;
window.downloadPDF = downloadPDF;
window.sendToN8n = sendToN8n;
window.setState = setState;
window.setAnswer = setAnswer;
window.toggleChip = toggleChip;
window.clearBackup = clearBackup;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
render();
</script>
</body>
</html>
